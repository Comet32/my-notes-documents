# åŸºç¡€ç¯‡ | ç¬¬äºŒéƒ¨åˆ†

[TOC]

## 10 | ç†è§£è™šæ‹Ÿ DOM åŠ key å±æ€§çš„ä½œç”¨

### å›é¡¾ JQuery

åœ¨ Vueã€Reactã€Angular ä¹‹å‰ï¼ŒJQuery å¯ä»¥è¯´æ˜¯å‰ç«¯çš„æ ‡å¿—ï¼Œå‡ ä¹å æ®äº†æ•´ä¸ªå‰ç«¯å¸‚åœºï¼Œç›´åˆ°ç°åœ¨ä¹Ÿæœ‰å¾ˆå¤šé¡¹ç›®ä¾ç„¶åœ¨ä½¿ç”¨ JQueryã€‚

![image-20190613235408569](assets/image-20190613235408569.png)

å®ƒå¸®åŠ©æˆ‘ä»¬ç®€åŒ–äº†æ“ä½œ DOM çš„ APIï¼Œå¯ä»¥å¾ˆå®¹æ˜“ä¸º DOM ç»‘å®šäº‹ä»¶æ¥æ“ä½œ DOMã€‚

![image-20190613235712454](assets/image-20190613235712454.png)

ä½†éšç€ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œä¼šå‡ºç°è¶Šæ¥è¶Šå¤šçš„äº‹ä»¶ï¼Œä½¿æˆ‘ä»¬é€šè¿‡äº‹ä»¶æ¥æ“ä½œä¸åŒçš„ DOM æˆ–è€…æ˜¯ç›¸åŒçš„ DOM çš„æ¯æ¬¡è¿­ä»£éƒ½å¾ˆå°å¿ƒç¿¼ç¿¼ï¼Œå¯ä»¥è¯´å°±æ˜¯è¿™ä¸ªç—›ç‚¹é€ å°±äº† React å’Œ Vue çš„è¯ç”Ÿã€‚

### å†çœ‹ Vue

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ vue æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªç—›ç‚¹çš„ã€‚

![image-20190613235905157](assets/image-20190613235905157.png)

å¯ä»¥è¯´ï¼Œåœ¨è¿™ä¸€å— React å’Œ Vue æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œéƒ½æ˜¯é€šè¿‡å¼•å…¥ä¸€ä¸ªæ•°æ®ä¸­é—´å±‚ï¼Œæˆ‘ä»¬çš„äº‹ä»¶ä¸å†æ˜¯ç›´æ¥æ“ä½œ DOMï¼Œè€Œæ˜¯äº‹ä»¶å»æ”¹å˜æ•°æ®ï¼Œæ•°æ®æ˜ å°„åˆ°çœŸå®çš„ DOMï¼Œè¿™éƒ¨åˆ†çš„åŠŸèƒ½æ˜¯ç”± Vue çš„åº•å±‚å¸®åŠ©æˆ‘ä»¬å¤„ç†çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸å†ç›´æ¥æ“ä½œ DOMã€‚

æ•°æ®çš„æ›´æ–°å¼•èµ· DOM çš„æ›´æ–°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å°½å¯èƒ½çš„é«˜æ•ˆçš„æ›´æ–° DOM å‘¢ï¼Ÿ

å› ä¸ºæ“ä½œ DOM æ˜¯ä¸€ä»¶éå¸¸æ¶ˆè€—æ€§èƒ½çš„ä¸€ä»¶äº‹æƒ…ï¼Œè€Œä¸ºäº†ç”¨æˆ·ä½“éªŒæ›´å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥å°½å¯èƒ½çš„ä½¿ç”¨ä¹‹å‰çš„ DOMï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦å¼•å…¥è™šæ‹Ÿ DOM çš„æœºåˆ¶äº†ã€‚

![image-20190614000350276](assets/image-20190614000350276.png)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œstateï¼ˆæ•°æ®ï¼‰+ templateï¼ˆæ¨¡ç‰ˆï¼‰å°±èƒ½å¤Ÿæœ€ç»ˆç”Ÿæˆä¸€ä¸ªç±»ä¼¼äº DOM çš„æ•°æ®ç»“æ„ï¼ˆæ³¨æ„ï¼Œæ˜¯æ•°æ®ç»“æ„ï¼‰ï¼Œåœ¨è¿™ä¸ªæ•°æ®ç»“æ„ä¸­æˆ‘ä»¬ä¿ç•™ç€è¿™ä¸ªèŠ‚ç‚¹çš„ä¸€äº›ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»å‹ã€å±æ€§ã€äº‹ä»¶ç­‰ï¼Œå½“æ•°æ®æ›´æ–°ä¹‹åï¼Œæˆ‘ä»¬ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ï¼Œå‰åçš„æ•°æ®ç»“æ„æˆ‘ä»¬é€šè¿‡ç®—æ³•çš„å¯¹æ¯”ï¼Œç„¶åæŸ¥æ‰¾å‡ºéœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ï¼Œå°½å¯èƒ½çš„å¤ç”¨ DOMï¼Œæå‡æ€§èƒ½ã€‚

![image-20190614003928181](assets/image-20190614003928181.png)

é‚£è¦æŸ¥æ‰¾ä¸¤æ£µæ ‘çš„å·®åˆ«ï¼Œå…¶æ—¶é—´å¤æ‚åº¦æ˜¯ O(n3)ï¼Œå…¶æ€§èƒ½å¾ˆå·®ã€‚è€ƒè™‘åˆ°å‰ç«¯é¡µé¢çš„ç»“æ„ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šå‡ºç°è·¨å±‚çº§çš„ç§»åŠ¨èŠ‚ç‚¹ï¼ŒåŸºäºè¿™ä¸ªå‡è®¾ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„ç®—æ³•ï¼Œåªéœ€è¦æ¯”å¯¹åŒå±‚çº§çš„èŠ‚ç‚¹ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¯”å¯¹ç›¸åŒé¢œè‰²æ¡†ä¸­çš„èŠ‚ç‚¹ï¼Œå¾—å‡ºéœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ã€‚

#### åœºæ™¯ 1 - ç§»åŠ¨

![image-20190614004338717](assets/image-20190614004338717.png)

> B C D ä¸ºä¸åŒçš„å…ƒç´ èŠ‚ç‚¹ï¼Œå¯èƒ½åˆ†åˆ«æ˜¯ spanã€divã€p

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦è¾¹çš„æ ‘ç»“æ„ä¸­ï¼ŒA èŠ‚ç‚¹ä¸‹æœ‰ Bã€Cã€D ä¸‰ä¸ªèŠ‚ç‚¹ï¼ŒC èŠ‚ç‚¹ä¸‹æœ‰ Eã€Fï¼Œæˆ‘ä»¬éœ€è¦å°†å·¦è¾¹çš„æ ‘çŠ¶ç»“æ„å˜ä¸ºå³è¾¹çš„æ ‘çŠ¶ç»“æ„ï¼Œé‚£ä¹ˆå¯¹äºæ“ä½œ DOM è€Œè¨€ï¼Œå…¶å®åªéœ€è¦å°† Cã€Dã€B çš„èŠ‚ç‚¹ä½ç½®è¿›è¡Œæ›´æ¢å°±è¡Œã€‚

#### åœºæ™¯ 2 - åˆ é™¤æ–°å»º

![image-20190614004616303](assets/image-20190614004616303.png)

è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°† C èŠ‚ç‚¹ç§»åŠ¨åˆ° B èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸­ï¼Œå¯¹äºç®—æ³•è€Œè¨€ï¼Œæ¯”å¯¹çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå°† C èŠ‚ç‚¹åˆ é™¤ï¼Œç„¶åå†åœ¨ B èŠ‚ç‚¹ä¸­åˆ›å»ºæ–°çš„ C èŠ‚ç‚¹ï¼Œç„¶ååœ¨ C èŠ‚ç‚¹ä¸­åˆ›å»º Eã€F èŠ‚ç‚¹ï¼Œæ‰€ä»¥ Cã€Eã€F å¹¶ä¸èƒ½ç›´æ¥**å¤ç”¨**ã€‚è™½ç„¶è¿™å¹¶ä¸æ˜¯æœ€ä¸ºç†æƒ³çš„ç®—æ³•æ–¹å¼ï¼ˆæœ€ä¸ºç†æƒ³æ˜¯ç›´æ¥ç§»åŠ¨ C èŠ‚ç‚¹ï¼Œä½†ç”±äºåŒå±‚æ¯”è¾ƒç®—æ³•çš„å‡è®¾ï¼Œè¿™æ˜¯æ²¡æœ‰åŠæ³•åšåˆ°çš„ï¼‰ï¼Œä½†å¥½çš„ä¸€ç‚¹æ˜¯æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨çš„æ“ä½œ DOMã€‚

#### åœºæ™¯ 3 - åˆ é™¤æ–°å»º

![image-20190614005332247](assets/image-20190614005332247.png)

å¦‚ä¸Šæ‰€ç¤ºï¼Œå°† C èŠ‚ç‚¹æ›´æ¢ä¸º G èŠ‚ç‚¹ï¼ŒEã€F èŠ‚ç‚¹ä¸æ¢ï¼Œä½†å¯¹äºåŒå±‚æ¯”è¾ƒçš„ç®—æ³•è€Œè¨€ï¼Œå½“å‘ç° C èŠ‚ç‚¹å·²ç»ä¸å­˜åœ¨æ—¶å°±ç›´æ¥åˆ é™¤æ‰ï¼Œå…¶ Eã€F èŠ‚ç‚¹ä¹Ÿä¼šè¢«ç›¸åº”çš„åˆ é™¤ï¼Œç„¶åæ‰æ˜¯æ·»åŠ  G èŠ‚ç‚¹å’Œ Eã€F èŠ‚ç‚¹ã€‚

#### åœºæ™¯ 4 - æ›´æ–°åˆ é™¤æ–°å»ºï¼ˆæ—  keyï¼‰

![image-20190614005621530](assets/image-20190614005621530.png)

> B1 B2 B3 æ˜¯ç›¸åŒç±»å‹çš„èŠ‚ç‚¹ï¼Œå¯èƒ½å…¨æ˜¯ li

å½“æ”¹å˜å¦‚ä¸Šå›¾æ‰€ç¤ºæ—¶ï¼Œç®—æ³•æ¯”è¾ƒ B1ã€B2 å¹¶ä¸çŸ¥é“æˆ‘ä»¬æ˜¯è¦ç§»åŠ¨è¿˜æ˜¯æ›´æ–°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±æ˜¯ç›´æ¥å°† B1 æ›´æ–°ä¸ºäº† B2ï¼ŒB2 æ›´æ–°ä¸ºäº† B1ï¼ŒB3 è¿˜æ˜¯ä¿ç•™ç€ï¼Œè¿™æ—¶ Eã€F èŠ‚ç‚¹å®é™…ä¸Šæ— æ³•å¤ç”¨ï¼Œè€Œä¼šæ–°å»ºã€‚æ‰€ä»¥ï¼Œé’ˆå¯¹è¿™æ ·çš„åœºæ™¯æˆ‘ä»¬å¢åŠ  key å±æ€§æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

#### åœºæ™¯ 5 - ç§»åŠ¨ï¼ˆæœ‰ keyï¼‰

![image-20190614010112835](assets/image-20190614010112835.png)

å½“æœ‰äº† key ä¹‹åï¼Œå°±ä¼šå˜å¾—å’Œåœºæ™¯ 1 ç›¸åŒï¼Œæœ€ç»ˆå°±åªæ˜¯èŠ‚ç‚¹çš„ç§»åŠ¨ã€‚

#### åœºæ™¯ 6 - æ’å…¥ï¼ˆæœ‰ keyï¼‰

![image-20190614010222269](assets/image-20190614010222269.png)

å¦‚ä¸Šå›¾æ›´æ–°è¿‡ç¨‹ï¼Œå¦‚æœæ²¡æœ‰ keyï¼Œåˆ™ä¼šæ˜¯å°† B2 æ›´æ–°ä¸º B4ï¼ŒB3 æ›´æ–°ä¸º B2ï¼Œç„¶åæ–°å»º B3ã€‚å¦‚æœæœ‰ keyï¼Œåˆ™æˆ‘ä»¬åªéœ€è¦æ’å…¥ B4 å°±å¯ä»¥äº†ã€‚

### demo

> æ¼”ç¤º DEMO æºç  /src/views/1.3
>
> è¯·èŠ±æ—¶é—´ç†è§£è¿™äº› demoï¼Œè¿™äº› demo å°±æ˜¯å°†ä¸Šé¢æ‰€è®²åˆ°çš„å†…å®¹é€šè¿‡ vue çš„æ“ä½œæ¥å®ç°äº†ä¸€éã€‚

è¿™é‡Œå°†ç¬¬ä¸€ä¸ªåœºæ™¯çš„ä»£ç æ‹¿æ¥è¯´ä¸€ä¸‹ï¼š

```jsx
<template>
  <div class="border">
    <h1>A ç»“ç‚¹</h1>
    <button @click="orderAsc = !orderAsc">ç§»åŠ¨</button>
    <div v-if="orderAsc">
      <ChildrenB />
      <ChildrenC></ChildrenC>
      <ChildrenD />
    </div>
    <div v-else>
      <ChildrenC> </ChildrenC>
      <ChildrenD />
      <ChildrenB />
    </div>
  </div>
</template>
<script>
import ChildrenB from "./ChildrenB";
import ChildrenC from "./ChildrenC";
import ChildrenD from "./ChildrenD";
export default {
  components: {
    ChildrenB,
    ChildrenC,
    ChildrenD
  },
  data() {
    return {
      orderAsc: true
    };
  }
};
</script>

```

- å½“æˆ‘ä»¬ç‚¹å‡» `<button>` ä¹‹åï¼ŒorderAsc ä¼šå–åä»è€Œæ”¹å˜ä¸‹é¢èŠ‚ç‚¹çš„æ’åˆ—ã€‚ç”±äºæ¯ä¸ªç»„ä»¶ï¼ˆChildrenBã€Cã€Dï¼‰åœ¨å…¶å†…éƒ¨éƒ½å¯¹ç»„ä»¶åœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œæ§åˆ¶å°çš„æ‰“å°æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥çŸ¥é“å½“é¡µé¢ä¸­çš„èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™äº›ç»„ä»¶æ˜¯å¦é‡æ–°æŒ‚è½½ã€æ›´æ–°ã€åˆ é™¤ã€‚æ¯”å¦‚ ChildrenB èŠ‚ç‚¹çš„ä»£ç ï¼š

  ```jsx
  <template>
    <div class="border1">
      <h2>B ç»“ç‚¹ {{ number }}</h2>
      <slot></slot>
    </div>
  </template>
  <script>
  export default {
    props: {
      number: Number
    },
    mounted() {
      console.log(`B${this.number || ""} mounted`);
    },
    updated() {
      console.log(`B${this.number || ""} updated`);
    },
    destroyed() {
      console.log(`B${this.number || ""} destroyed`);
    }
  };
  </script>
  
  ```

- åœ¨åœºæ™¯ä¸€ä¸­ï¼Œç”±äºåŒçº§èŠ‚ç‚¹éƒ½ä¸ºä¸åŒçš„ç»„ä»¶ï¼Œå½“ç®—æ³•è¿›è¡Œå¯¹æ¯”ä¹‹åï¼Œä¼šå‘ç°åªéœ€è¦ç§»åŠ¨ä½ç½®å°±å¯ä»¥å®Œæˆæ“ä½œï¼Œæ‰€ä»¥å¹¶ä¸ä¼šå°†è¿™äº›ç»„ä»¶èŠ‚ç‚¹åˆ é™¤ï¼Œå› æ­¤åœ¨æ§åˆ¶å°ä¸­ä¹Ÿä¼šä¸æ‰§è¡Œè¿™äº›ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚

### è¯¾åä¹ é¢˜ 5

ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ index æ¥ä½œä¸º keyï¼Ÿ

> æœ‰åŒå­¦çš„å›ç­”ï¼š
>
> æµ‹è¯•å‘ç°ï¼Œæœ€å¥½ä¸è¦ç”¨indexä½œä¸ºkeyï¼Œç”¨indexä½œä¸ºkeyæœ‰æ—¶å€™ä¼šå¯¼è‡´bugï¼Œå°¤å…¶æ˜¯itemæ˜¯å…·æœ‰æŸç§çŠ¶æ€çš„æ—¶å€™ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚æœæœ‰ABCä¸‰ä¸ªitemï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªAæ˜¯é€‰ä¸­çš„ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘åœ¨Aå‰é¢æ·»åŠ Dï¼Œç”¨indexä½œä¸ºkeyå°±ä¼šå˜æˆDæ˜¯é€‰ä¸­çš„äº†ï¼Œå»ºè®®ç”¨å”¯ä¸€idæ¥ä½œä¸ºkeyã€‚



## 11 | vue å¦‚ä½•è§¦å‘ç»„ä»¶çš„æ›´æ–°

vue æ˜¯ç”±æ•°æ®é©±åŠ¨çš„è§†å›¾æ¡†æ¶ï¼Œæ‰€è°“æ•°æ®é©±åŠ¨å°±æ˜¯æˆ‘ä»¬çš„ DOM æ˜¯é€šè¿‡æ•°æ®æ¥æ˜ å°„çš„ï¼Œæˆ‘ä»¬åªæœ‰åœ¨æ•°æ®æ”¹å˜çš„æ—¶å€™è§†å›¾æ‰ä¼šæ”¹å˜ã€‚

![image-20190614161717894](assets/image-20190614161717894.png)

æ²¡æœ‰ç‰¹æ®Šæƒ…å†µæˆ‘ä»¬ä¸è¦å»ç›´æ¥æ›´æ”¹ DOMï¼Œå¹¶ä¸”ã€Œç‰¹æ®Šæƒ…å†µã€å¾ˆæœ‰å¯èƒ½æ˜¯ä½ æ‰€è®¤ä¸ºçš„ã€Œç‰¹æ®Šæƒ…å†µã€ï¼Œé‡åˆ°è¿™ç§ã€Œç‰¹æ®Šæƒ…å†µã€æ—¶ï¼Œæˆ‘ä»¬æœ€å¥½é™ä¸‹æ¥å¥½å¥½æƒ³æƒ³æ˜¯ä¸æ˜¯çœŸçš„ã€Œç‰¹æ®Šæƒ…å†µã€ã€‚

### æ•°æ®æ¥æºï¼ˆå•å‘çš„ï¼‰

ä¸‰ä¸ªéƒ¨åˆ†ï¼š

![image-20190614161921449](assets/image-20190614161921449.png)

### çŠ¶æ€ data VS å±æ€§ props

- çŠ¶æ€æ˜¯ç»„ä»¶è‡ªèº«çš„æ•°æ®
- å±æ€§æ˜¯æ¥è‡ªçˆ¶ç»„ä»¶çš„æ•°æ®
- çŠ¶æ€çš„æ”¹å˜æœªå¿…ä¼šè§¦å‘æ›´æ–°
- å±æ€§çš„æ”¹å˜æœªå¿…ä¼šè§¦å‘æ›´æ–°

### demo

> æ¼”ç¤º DEMO æºç  /src/views/1.4

é€šè¿‡è¿™ä¸ª demo æ¥äº†è§£ç»„ä»¶çš„ä½•æ—¶æ›´æ–°ä½•æ—¶ä¸æ›´æ–°ã€‚

å…ˆçœ‹ä»£ç ï¼š

```jsx
export default {
  components: {
    PropsAndData
  },
  data() {
    this.name = name;
    return {
      info: {},
      // info: {
      //   number: undefined
      // },
      list: []
    };
  },
  methods: {
    handleNameChange() {
      this.name = "vue" + Date.now();
      console.log("this.name å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è§¦å‘å­ç»„ä»¶æ›´æ–°", this.name);
    },
    handleInfoChange() {
      this.info.number = 1;
      // this.$set(this.info, 'number', 1)
      console.log("this.info å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è§¦å‘å­ç»„ä»¶æ›´æ–°", this.info);
    },
    handleListChange() {
      this.list.push(1, 2, 3);
      console.log("this.list çš„å¼•ç”¨æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯è§¦å‘äº†å­ç»„ä»¶æ›´æ–°", this.list);
    }
  }
};
```

- å½“æˆ‘ä»¬è§¦å‘ `handleNameChang` å’Œ `handleInfoChange` æ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…ä¼šæ”¹å˜ `this.name` å’Œ `this.info.number` çš„å€¼ï¼Œä½†å¹¶ä¸ä¼šè§¦å‘å­ç»„ä»¶çš„æ›´æ–°ï¼ŒåŸå› åœ¨äºï¼š
  - `this.name` å¹¶æ²¡æœ‰é€šè¿‡ data æ–¹æ³•è¿›è¡Œè¿”å›ï¼Œåªæ˜¯åœ¨ data æ–¹æ³•ä¸­é€šè¿‡ `this.name = name` è¿›è¡Œäº†èµ‹å€¼ã€‚
  - `this.info.number`ï¼Œè™½ç„¶ `this.info` è¿›è¡Œäº†è¿”å›ï¼Œä½† `this.info.number` å¹¶æ²¡æœ‰èµ‹äºˆåˆå§‹å€¼ã€‚
- å½“æˆ‘ä»¬è§¦å‘ `handleListChange` æ–¹æ³•æ—¶ï¼Œè™½ç„¶ `this.list` çš„å¼•ç”¨æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½† `push` æ–¹æ³•è¢« vue æ›´æ”¹è¿‡ï¼Œåªè¦è°ƒç”¨æ­¤æ–¹æ³•æ”¹å˜æ•°æ®åˆ™ä¼šè§¦å‘æ›´æ–°ã€‚

å†æ¥çœ‹ä¸€ç§æƒ…å†µï¼Œä»£ç å¦‚ä¸‹ï¼š

```jsx
<template>
  <div>
    <p>props.info: {{ info }}</p>
    <p>props.name: {{ name }}</p>
    <p>props.list: {{ list }}</p>
    <p>data.a: {{ a }}</p>
    <p>
      <button @click="handleBChange">change data.b</button>
    </p>
  </div>
</template>
<script>
export default {
  name: "PropsAndData",
  props: {
    info: Object,
    name: String,
    list: Array
  },
  data() {
    return {
      a: "hello",
      b: "world"
    };
  },
  updated() {
    console.log("è§¦å‘ PropsAndData updated");
  },
  methods: {
    handleBChange() {
      this.b = "vue" + Date.now();
      console.log("data.b å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è§¦å‘ç»„ä»¶æ›´æ–°", this.b);
    }
  }
};
</script>
```

- å½“æˆ‘ä»¬é€šè¿‡ç‚¹å‡»æŒ‰é’®è§¦å‘ç‚¹å‡»äº‹ä»¶ä»è€Œæ‰§è¡Œ `handleBChange` æ–¹æ³•æ—¶ï¼Œè™½ç„¶ `this.b` åœ¨ `data` æ–¹æ³•ä¸­è¿›è¡Œäº†è¿”å›ï¼Œä½†å¹¶æ²¡æœ‰æ›´æ–°ï¼ŒåŸå› æ˜¯è¿™ä¸ªçŠ¶æ€å¹¶æ²¡æœ‰åœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨ã€‚

### å“åº”å¼æ›´æ–°

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Vue æ˜¯å¦‚ä½•åšå“åº”å¼æ›´æ–°ï¼Œå“ªäº›æ•°æ®æ¥åšä¾èµ–æ”¶é›†ï¼Œå“ªäº›æ•°æ®ä¸éœ€è¦ã€‚å…ˆçœ‹å›¾ï¼š

![image-20190614180556530](assets/image-20190614180556530.png)

å½“ vue åšå®ä¾‹åŒ–æ—¶ä¼šå¯¹ Data ä¸‹çš„æ•°æ®åš `getter` å’Œ `setter` çš„è½¬åŒ–ï¼Œæ‰€è°“çš„è½¬åŒ–å¯ä»¥è¯´ç›´ç™½ä¸€ç‚¹å…¶å®å°±æ˜¯å¯¹æ­¤æ•°æ®åšäº†ä¸€ä¸ªä¸­é—´çš„ä»£ç†å±‚ï¼Œæ— è®ºæ˜¯å–æ•°æ®ä¹Ÿå¥½è¿˜æ˜¯è®¾ç½®æ›´æ”¹æ•°æ®é‡æ–°èµ‹å€¼ä¹Ÿå¥½ï¼Œå®ƒéƒ½ä¼šç»è¿‡ä»£ç†å±‚ç„¶åå†å»æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªä»£ç†å±‚ä¸­å¯ä»¥åšä»»ä½•çš„ä¸€ä¸ªäº‹æƒ…ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å®ä¾‹åŒ–å¯¹æ•°æ®åšçš„è½¬åŒ–ã€‚

é‚£ä¹ˆå½“ç»„ä»¶è¿›è¡Œæ¸²æŸ“çš„æ—¶å€™ï¼ˆrenderï¼‰ï¼Œå¦‚æœæˆ‘ä»¬ä¼šéœ€è¦ä¸€äº› Data ä¸­çš„æ•°æ®ï¼Œå®ƒå°±ä¼šå°†è¿™ä¸ªæ•°æ®æ”¾åˆ° Watcher ä¹‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰ç”¨åˆ°åˆ™ä¸ä¼šè¿›å…¥ Watcher ä¹‹ä¸­ï¼ˆæ¯”å¦‚ä¸Šé¢ç¬¬äºŒä¸ªç¤ºä¾‹çš„æƒ…å†µï¼‰ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç»„ä»¶ä¸­çš„æ•°æ®æ›´æ”¹äº†ï¼Œå´æ²¡æœ‰è§¦å‘ç»„ä»¶æ›´æ–°çš„åŸå› ã€‚

### è¯¾åä¹ é¢˜ 6

æ•°ç»„æœ‰å“ªäº›æ–¹æ³•æ”¯æŒå“åº”å¼æ›´æ–°ï¼Ÿå¦‚ä¸æ”¯æŒå¦‚ä½•å¤„ç†ï¼Œåº•å±‚åŸç†æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ

é—®è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼Œæ•°ç»„çš„ä¸€äº›æ–¹æ³•æ˜¯ä¸ä¼šæ”¹å˜å…¶å¼•ç”¨çš„ï¼Œå…¶æ•°ç»„æœ¬èº«çš„å¼•ç”¨å¹¶æ²¡æœ‰æ”¹å˜ï¼Œé‚£ä¹ˆæœ¬åº”è¯¥ä¸ä¼šè§¦å‘ Watcherã€‚



## 12 | åˆç†åº”ç”¨è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨

### è®¡ç®—å±æ€§ computed

å¯ä»¥ç›´æ¥ç†è§£ä¸ºèƒ½å¤Ÿæ‰§è¡Œè®¡ç®—é€»è¾‘çš„å±æ€§ï¼Œç‰¹ç‚¹å¦‚ä¸‹ï¼š

- å‡å°‘æ¨¡ç‰ˆä¸­è®¡ç®—é€»è¾‘
- æ•°æ®ç¼“å­˜
- ä¾èµ–å›ºå®šçš„æ•°æ®ç±»å‹ï¼ˆå“åº”å¼æ•°æ®ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½æ˜¯å…¶ä»–çš„å…¨å±€æ•°æ®ã€‚

å¥½å¤„å½“ç„¶æ˜¯æé«˜æ€§èƒ½ã€‚

#### demo

> æ¼”ç¤º DEMO æºç  /src/views/1.5

```jsx
<template>
  <div>
    <p>Reversed message1: "{{ reversedMessage1 }}"</p>
    <p>Reversed message2: "{{ reversedMessage2() }}"</p>
    <p>{{ now }}</p>
    <button @click="() => $forceUpdate()">forceUpdate</button>
    <br />
    <input v-model="message" />
  </div>
</template>
<script>
  export default {
    data() {
      return {
        message: "hello vue"
      };
    },
      computed: {
        // è®¡ç®—å±æ€§çš„ getter
        reversedMessage1: function() {
          console.log("æ‰§è¡ŒreversedMessage1");
          return this.message
            .split("")
            .reverse()
            .join("");
        },
          now: function() {
            return Date.now();
          }
      },
        methods: {
          reversedMessage2: function() {
            console.log("æ‰§è¡ŒreversedMessage2");
            return this.message
              .split("")
              .reverse()
              .join("");
          }
        }
  };
</script>
```

- ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥æ›´æ–°ç»„ä»¶ï¼Œä¸€æ˜¯ä½¿ç”¨ `button` æ¥å¼ºåˆ¶æ›´æ–°ï¼ŒäºŒæ˜¯åœ¨ `input` ä¸­è¾“å…¥ä¸€äº›å­—ç¬¦æ›´æ”¹å“åº”å¼æ•°æ® `message` æ¥è§¦å‘æ›´æ–°ã€‚ç¬¬ä¸€ç§æ›´æ–°æ–¹å¼ä¹Ÿå¯ä»¥æƒ³è±¡æˆï¼Œç»„ä»¶å› ä¸ºå…¶ä»–æ•°æ®çš„æ”¹å˜è€Œè¢«æ›´æ–°äº†ã€‚
- è¿™ä¸ªç¤ºä¾‹ä¸»è¦æ˜¯ç”¨äºè®©æˆ‘ä»¬ç†è§£ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ computed è®¡ç®—å±æ€§ã€‚å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨ç°æœ‰æ•°æ®ç”¨äºè®¡ç®—åçš„æ•°æ®æ—¶ï¼Œå¦‚æœä½¿ç”¨ `methods` æ–¹æ³•ï¼Œåˆ™æ— è®ºæ­¤ç°æœ‰æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œåªè¦ç»„ä»¶å‘ç”Ÿæ›´æ–°åˆ™éƒ½ä¼šæ‰§è¡Œï¼Œè€Œå½“æˆ‘ä»¬ä½¿ç”¨ computed æ—¶åˆ™ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸º computed ä¸­çš„æ–¹æ³•å±æ€§åªæœ‰å½“å…¶æ‰€ä½¿ç”¨çš„å“åº”å¼æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶æ‰ä¼šé‡æ–°æ‰§è¡Œå¹¶è®¡ç®—è¿”å›å‡ºæ‰€éœ€è¦çš„æ•°æ®ã€‚

### ä¾¦å¬å™¨ watch

watch æ˜¯ç”¨äºç›‘å¬æ•°æ®çš„å˜åŒ–çš„ï¼Œç‰¹ç‚¹ï¼š

- æ›´åŠ çµæ´»ã€é€šç”¨
- watch ä¸­å¯ä»¥æ‰§è¡Œä»»ä½•é€»è¾‘ï¼Œå¦‚å‡½æ•°é˜²æŠ–èŠ‚æµï¼ŒAjax å¼‚æ­¥è·å–æ•°æ®ï¼Œç”šè‡³æ“ä½œ DOM

#### demo

```jsx
<template>
  <div>
    {{ $data }}
    <br />
    <button @click="() => (a += 1)">a+1</button>
  </div>
</template>
<script>
export default {
  data: function() {
    return {
      a: 1,
      b: { c: 2, d: 3 },
      e: {
        f: {
          g: 4
        }
      },
      h: []
    };
  },
  watch: {
    a: function(val, oldVal) {
      this.b.c += 1;
      console.log("new: %s, old: %s", val, oldVal);
    },
    "b.c": function(val, oldVal) {
      this.b.d += 1;
      console.log("new: %s, old: %s", val, oldVal);
    },
    "b.d": function(val, oldVal) {
      this.e.f.g += 1;
      console.log("new: %s, old: %s", val, oldVal);
    },
    e: {
      handler: function(val, oldVal) {
        this.h.push("ğŸ˜„");
        console.log("new: %s, old: %s", val, oldVal);
      },
      // e å¯¹è±¡ä¸‹çš„ä»»ä½•å±æ€§å‘ç”Ÿå˜åŒ–éƒ½ä¼šè§¦å‘è¿™ä¸ªç›‘å¬å™¨æ–¹æ³•çš„æ‰§è¡Œ
      deep: true
    },
    h(val, oldVal) {
      console.log("new: %s, old: %s", val, oldVal);
    }
  }
};
</script>
```

- å½“æˆ‘ä»¬ç‚¹å‡» `button` åä¼šä½¿ `a` çŠ¶æ€ +1ï¼Œä»è€Œè§¦å‘ a çš„ç›‘å¬å™¨ï¼Œä½¿ b.c å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘ b.c çš„ç›‘å¬å™¨ï¼ˆè¿™é‡Œæ³¨æ„åœ¨ 27 è¡Œä»£ç ä¸­å¯ä»¥çœ‹åˆ°ä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹å¼å¯ä»¥ä¼ å…¥å¯¹æŸä¸ªå¯¹è±¡ä¸‹çš„å±æ€§è¿›è¡Œç›‘å¬ï¼‰ï¼Œç„¶åæ˜¯è§¦å‘ b.d çš„å˜åŒ–ï¼Œb.d åˆä¼šè§¦å‘ e.f.g çš„å˜åŒ–ï¼Œç”±äº e çŠ¶æ€çš„ç›‘å¬å™¨æ·»åŠ äº† `deep: true` é…ç½®ï¼Œæ‰€ä»¥è™½ç„¶æ²¡æœ‰æ”¹å˜ eï¼Œä½† e å¯¹è±¡ä¸‹çš„ä»»ä½•å±æ€§å‘ç”Ÿå˜åŒ–éƒ½ä¼šè§¦å‘ e çš„ç›‘å¬å™¨å‡½æ•°çš„æ‰§è¡Œï¼Œæœ€åï¼Œh çš„ç›‘å¬å™¨ä¹Ÿè¢«è§¦å‘ã€‚

### computed VS watch

- computed èƒ½åšçš„ï¼Œwatch éƒ½èƒ½åšï¼Œåä¹‹åˆ™ä¸è¡Œ
- èƒ½ç”¨ computed çš„å°½é‡ç”¨ computedï¼Œè¿™æ˜¯å› ä¸º computed åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ›´ç®€å•

é‚£æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™ç”¨ computedï¼Œä»€ä¹ˆæ—¶å€™ç”¨ watch å‘¢ï¼Ÿå…ˆçœ‹ demoï¼š

ä½¿ç”¨ computedï¼š

```jsx
<template>
  <div>
    {{ fullName }}

    <div>firstName: <input v-model="firstName" /></div>
    <div>lastName: <input v-model="lastName" /></div>
  </div>
</template>
<script>
export default {
  data: function() {
    return {
      firstName: "Foo",
      lastName: "Bar"
    };
  },
  computed: {
    fullName: function() {
      return this.firstName + " " + this.lastName;
    }
  },
  watch: {
    fullName: function(val, oldVal) {
      console.log("new: %s, old: %s", val, oldVal);
    }
  }
};
</script>
```

- æ³¨æ„è¿™é‡Œ computed çš„å±æ€§ä¾ç„¶å¯ä»¥ç”¨äº watch è¿›è¡Œç›‘å¬

ä½¿ç”¨ watchï¼š

```jsx
<template>
  <div>
    {{ fullName }}

    <div>firstName: <input v-model="firstName" /></div>
    <div>lastName: <input v-model="lastName" /></div>
  </div>
</template>
<script>
export default {
  data: function() {
    return {
      firstName: "Foo",
      lastName: "Bar",
      fullName: "Foo Bar"
    };
  },
  watch: {
    firstName: function(val) {
      this.fullName = val + " " + this.lastName;
    },
    lastName: function(val) {
      this.fullName = this.firstName + " " + val;
    }
  }
};
</script>

```

- é¦–å…ˆè¯´ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªèƒ½å¤Ÿæ”¹å˜ firstName çš„ input æ¡†å’Œä¸€ä¸ªèƒ½å¤Ÿæ”¹å˜ lastName çš„ input æ¡†ï¼Œé€šè¿‡æ”¹å˜å…¶ä¸­ä¹‹ä¸€ç„¶åæ˜¾ç¤ºæ•´ä¸ªåç§°ã€‚
- ä½¿ç”¨ computedï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ computed å­—æ®µä¸‹æ·»åŠ ä¸€ä¸ª `fullName` æ–¹æ³•å±æ€§ï¼Œç„¶åé€šè¿‡ `this.firstName` å’Œ `this.lastName` çš„å€¼æ¥è¿”å›å³å¯ï¼Œå½“è¿™ä¸¤ä¸ªçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒfullName å°±ä¼šå‘ç”Ÿå˜åŒ–ä»è€Œæ”¹å˜æ›´æ–°ç»„ä»¶ã€‚
- ä½¿ç”¨ watchï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ `data` å­—æ®µä¸­æ·»åŠ  `fullName` çŠ¶æ€ï¼Œç„¶ååˆ†åˆ«ç›‘å¬ `firstName` å’Œ `lastName`ï¼Œè¿™æ ·ç›¸æ¯”äº computed è€Œè¨€å°±ä¼šç¨å¾®å†—ä½™ä¸€äº›ã€‚

å¯¹äºåˆ°åº•æ˜¯ä½¿ç”¨ computed è¿˜æ˜¯ watchï¼Œå…¶å®åœ¨å¾ˆå¤šæ—¶å€™ä½ å¾ˆéš¾åœ¨ç¬¬ä¸€æ—¶é—´å°±æƒ³åˆ°åˆ°åº•åº”è¯¥ç”¨å“ªä¸€ä¸ªï¼Œæ¯”å¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œè™½ç„¶ watch ç›¸å¯¹è€Œè¨€æ¯”è¾ƒå†—ä½™ï¼Œä½†ä¹Ÿèƒ½å¤Ÿæ¥å—ã€‚å½“ä½ é¡¹ç›®åšå¤šäº†ï¼Œå®ƒä»¬ä¹‹é—´çš„é€‰æ‹©ä¼šæˆä¸ºä¸€ä»¶æ°´åˆ°æ¸ æˆçš„äº‹æƒ…ã€‚

> è¿™é‡Œæˆ‘æƒ³è¯´æ˜ä¸€ç§ä½¿ç”¨ computed è€Œé watch çš„æƒ…å†µï¼Œå½“ä½ éœ€è¦ç”¨åˆ°å¤šä¸ªçŠ¶æ€ï¼ˆæ¯”å¦‚ä¸Šé¢ç”¨åˆ°äº†ä¸¤ä¸ªï¼‰æ—¶ï¼Œå°±å°½é‡ä½¿ç”¨ computed è€Œé watchï¼Œå› ä¸ºä½¿ç”¨ watch ä½ éœ€è¦ç›‘å¬å¤šä¸ªçŠ¶æ€ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚

### è¯¾åä¹ é¢˜

> å¯¹ Watch Demo è¿›è¡Œé˜²æŠ–æ”¹é€ ï¼Œæ—¢ç›´åˆ°ç”¨æˆ·åœæ­¢è¾“å…¥è¶…è¿‡ 500ms åï¼Œæ‰æ›´æ–° fullName

```jsx
export default {
  data: function() {
    return {
      firstName: "Foo",
      lastName: "Bar",
      fullName: "Foo Bar"
    };
  },
  watch: {
    firstName: function(val) {
      clearTimeout(this.firstTimeout);
      this.firstTimeout = setTimeout(() => {
        this.fullName = val + " " + this.lastName;
      }, 500);
    },
    lastName: function(val) {
      clearTimeout(this.lastTimeout);
      this.lastTimeout = setTimeout(() => {
        this.fullName = this.firstName + " " + val;
      }, 500);
    }
  }
};
```

- æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ `this.xxx` æ¥æ¥æ”¶ `setTimeout` çš„è¿”å›å€¼ï¼Œç”¨äºå–æ¶ˆå»¶æ—¶å™¨ã€‚



## 13 | ç”Ÿå‘½å‘¨æœŸçš„åº”ç”¨åœºæ™¯å’Œå‡½æ•°å¼ç»„ä»¶

æ¯ä¸ª vue ç»„ä»¶åœ¨è¢«åˆ›å»ºçš„æ—¶å€™éƒ½ä¼šç»å†ä¸€ä¸ªåˆå§‹åŒ–è¿‡ç¨‹ï¼Œæ•°æ®æ›´æ–°å’Œç»„ä»¶é”€æ¯æ—¶ä¹Ÿä¼šè§¦å‘ä¸€ç³»åˆ—çš„é’©å­å‡½æ•°ï¼Œè¿™äº›é’©å­å‡½æ•°å¯ä»¥ç”¨äºæ‰§è¡Œä¸€äº›ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚

### ç”Ÿå‘½å‘¨æœŸ

![image-20190614194208222](assets/image-20190614194208222.png)

ç”Ÿå‘½å‘¨æœŸä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š

- åˆ›å»º
- æ›´æ–°
- é”€æ¯

åˆ›å»ºå’Œé”€æ¯åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œæ›´æ–°åˆ™ä¼šæ‰§è¡Œå¤šæ¬¡ã€‚

#### åˆ›å»ºé˜¶æ®µ

![image-20190614194313199](assets/image-20190614194313199.png)

- åœ¨ `beforeCreate` ä¹‹å‰ç»„ä»¶å®ä¾‹ä¼šåˆå§‹åŒ–äº‹ä»¶å’Œç”Ÿå‘½å‘¨æœŸ
- æ‰§è¡Œ `beforeCreate`
- `beforeCreate` ä¹‹åä¼šå¯¹æ•°æ®åšå“åº”å¼åŒ–çš„å¤„ç†ï¼ˆæ•°æ®è§‚æµ‹ï¼‰ï¼Œè¿˜æœ‰å±æ€§ã€ä¾¦å¬å™¨é…ç½®ç­‰
-  æ‰§è¡Œ `created`
- `created` ä¹‹ååˆ™æ˜¯æˆ‘ä»¬æ¨¡ç‰ˆç¼–è¯‘åˆ° renderï¼Œå¦‚æœæ˜¯ç›´æ¥å†™ render å‡½æ•°çš„è¯ï¼Œåˆ™æ­¤é˜¶æ®µè¢«è·³è¿‡ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯å†™ `<template>` è¿™æ ·çš„å½¢å¼
- æ‰§è¡Œ `beforeMount`
- æ‰§è¡Œ `render` ï¼Œrender ä¼šç”Ÿæˆè™šæ‹Ÿ DOMï¼Œç„¶åæŒ‚è½½åˆ°æµè§ˆå™¨ï¼Œå®ç°çœŸå® DOM
- æ‰§è¡Œ `mounted` ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ `mounted` ä¸­ä¼šåšå¼‚æ­¥è¯·æ±‚ã€æ“ä½œ DOMã€å®šæ—¶å™¨ç­‰æ“ä½œ
- åœ¨ `mounted` ä¹‹åï¼Œvue å¹¶ä¸æ‰¿è¯ºå…¶å­ç»„ä»¶ä¹Ÿä¼šå®ç°æŒ‚è½½ï¼ˆä¹Ÿå°±æ˜¯å½¢æˆçœŸå® DOMï¼‰ï¼Œæ‰€ä»¥æœ‰æ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨ `this.$nextTick` æ¥æ‰§è¡Œæ“ä½œ DOM 

#### æ›´æ–°é˜¶æ®µ

![image-20190614195826833](assets/image-20190614195826833.png)

é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œæ›´æ–°é˜¶æ®µæ˜¯å¤šæ¬¡æ‰§è¡Œçš„é˜¶æ®µï¼Œåœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æˆ–è€…è°ƒç”¨ `$forceUpdate` è¿›è¡Œå¼ºåˆ¶æ›´æ–°çš„æ—¶å€™ï¼Œåˆ™ä¼šå¼€å§‹æ›´æ–°é˜¶æ®µã€‚

- é¦–å…ˆï¼Œä¼šæ‰§è¡Œ `beforeUpdate`ï¼Œåœ¨æ­¤é’©å­ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç§»é™¤å·²ç»æ·»åŠ çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¹³æ—¶çš„ä¸šåŠ¡å¼€å‘å¾ˆéš¾ç”¨åˆ°ï¼Œä¸€èˆ¬æ˜¯åœ¨å¼€å‘ç»„ä»¶åº“ä¼šç”¨åˆ°ï¼‰ç­‰ï¼Œä½†åˆ‡è®°ä¸‡ä¸‡ä¸å¯æ›´æ”¹ä¾èµ–æ•°æ®ï¼Œä¼šé€ æˆæ­»å¾ªç¯ã€‚
- æ‰§è¡Œ `render`ï¼Œç”Ÿæˆæœ€æ–°çš„è™šæ‹Ÿ DOMï¼Œç„¶åæ›´æ–°æŒ‚è½½çœŸå® DOM
- ç„¶åï¼Œæ‰§è¡Œ `updated` ï¼ŒåŒ `mounted` ç›¸åŒä¹Ÿä¸æ‰¿è¯ºå­ç»„ä»¶ä¼šæ›´æ–°å®Œæ¯•å®ç°æŒ‚è½½ï¼Œæ‰€ä»¥æ“ä½œ DOM ä¾ç„¶ä¹Ÿéœ€è¦ä½¿ç”¨åˆ° `this.$nextTick` ã€‚è¿™ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æˆ‘ä»¬å¯ä»¥æ“ä½œ DOM æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ç­‰ï¼Œä¹ŸåŒæ ·ï¼Œå¯¹äºæ™®é€šçš„ä¸šåŠ¡å¼€å‘å¯èƒ½å¾ˆéš¾ä½¿ç”¨åˆ°ï¼Œåˆ‡è®°ä¸‡ä¸‡ä¸å¯æ›´æ”¹ä¾èµ–æ•°æ®ã€‚

#### é”€æ¯é˜¶æ®µ

![image-20190614200516875](assets/image-20190614200516875.png)

ç»„ä»¶è¢«é”€æ¯ä¹‹åä¹Ÿä¼šæä¾›ç»™æˆ‘ä»¬ä¸¤ä¸ªé’©å­ï¼š

- `beforeDestroy` æ˜¯é”€æ¯ä¹‹å‰æ‰§è¡Œçš„ï¼Œä¸€èˆ¬ç”¨äºç§»é™¤æ·»åŠ çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œè®¡æ—¶å™¨ç­‰ã€‚
- `destroyed` è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæå°‘ä½¿ç”¨ï¼ŒåŸºæœ¬ä¸Šä½¿ç”¨ `beforeDestroy` å°±è¶³å¤Ÿæ»¡è¶³åŸºæœ¬çš„ä½¿ç”¨ã€‚

#### demo

> æ¼”ç¤º DEMO æºç  /src/views/1.6

è¿™ä¸ª demo ä¸»è¦æ˜¯é€šè¿‡åœ¨ data å­—æ®µå’Œæ¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åœ¨æ§åˆ¶å°æ‰“å°ç”Ÿå‘½å‘¨æœŸçš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿäº†è§£ç”Ÿå‘½å‘¨æœŸçš„æ‰§è¡Œé¡ºåºäº†ã€‚

ä»£ç ä¸­ï¼Œå¦‚ä½•é”€æ¯ç»„ä»¶çš„ï¼š

```jsx
<Clock v-if="!destroyClock" />
```

- é€šè¿‡ `v-if` æŒ‡ä»¤æˆ‘ä»¬å°±å¯ä»¥å¾ˆç®€å•çš„æ ¹æ®ä¸€ä¸ªçŠ¶æ€æ¥åˆ›å»ºå’Œé”€æ¯ä¸€ä¸ªç»„ä»¶

ä»£ç ä¸­ï¼Œå¦‚ä½•æ›´æ–°ç»„ä»¶çš„ï¼š

```jsx
methods: {
  startClock() {
    clearInterval(this.clockInterval);
    if (this.start) {
      this.clockInterval = setInterval(() => {
        this.now = moment(new Date()).format("YYYY-MM-DD HH:mm:ss");
      }, 1000);
    }
  }
}
```

- ä¸æ–­çš„æ›´æ–°å“åº”å¼çŠ¶æ€ `this.now` çš„å€¼
- ä½¿ç”¨ `setInterval` ä¹‹å‰ï¼Œä¸€å®šå¾—è®°å¾—å…ˆæ¸…é™¤ä¹‹å‰æ‰€æ·»åŠ çš„å®šæ—¶å™¨

render é’©å­çš„æ‰§è¡Œä½ç½®ï¼š

```jsx
<template>
  <div>
    {{ log("render") }}
    {{ now }}
    <button @click="start = !start">{{ start ? "åœæ­¢" : "å¼€å§‹" }}</button>
  </div>
</template>
```

- ç¬¬ä¸‰è¡Œä¸­æˆ‘ä»¬æ‰“å°äº† `"render"`ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† `template`ï¼Œæ‰€ä»¥ `template` å°±ä¼šæ·»åŠ è¿› render ä¹‹ä¸­

### å‡½æ•°å¼ç»„ä»¶

å‡½æ•°å¼ç»„ä»¶ç›¸å¯¹äºæ™®é€šç»„ä»¶è€Œè¨€æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

- functional: true
- æ— çŠ¶æ€ã€æ— å®ä¾‹ã€æ²¡æœ‰ this ä¸Šä¸‹æ–‡ã€æ— ç”Ÿå‘½å‘¨æœŸ

å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œå½“æˆ‘ä»¬åœ¨ç»„ä»¶å®šä¹‰æ—¶ï¼Œç»™ä¸€ä¸ª `functional: true` çš„é…ç½®åˆ™å£°æ˜ä¸ºäº†ä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ã€‚

å‡½æ•°å¼ç»„ä»¶ä¸€èˆ¬æ˜¯ä½œä¸ºä¸€ä¸ªå±•ç¤ºå‹ç»„ä»¶æ¥ä½¿ç”¨çš„ï¼Œå¹¶ä¸”å°±åƒåœ¨ä¹‹å‰æ‰€çœ‹åˆ°çš„ï¼Œå¯ä»¥ç”¨äºæ¸²æŸ“ VNodeã€‚

å‡½æ•°å¼ç»„ä»¶ä¹Ÿå¯ä»¥åœ¨æ¨¡ç‰ˆä¸­åš**ä¸´æ—¶å˜é‡**ï¼Œåœ¨ vue çš„æ¨¡ç‰ˆä¸­æ˜¯æ²¡æœ‰æä¾›ä¸´æ—¶å˜é‡è¿™ä¸ªåŠŸèƒ½çš„ï¼Œä½†æ˜¯å¼€å‘è¿‡ç¨‹ä¸­ä¸´æ—¶å˜é‡æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œå¦åˆ™åœ¨æ¨¡ç‰ˆä¸­ä¼šå‡ºç°å¤šæ¬¡é‡å¤çš„é€»è¾‘è®¡ç®—ï¼Œå½“ç„¶ï¼Œè®¡ç®—å±æ€§åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå·²ç»å¸®æˆ‘ä»¬é¿å…äº†è¿™ä¸ªäº‹æƒ…ï¼Œä½†è®¡ç®—å±æ€§æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œéœ€è¦ä¾èµ–äºå“åº”å¼æ•°æ®ï¼Œè€Œä¸”æ¨¡ç‰ˆä¸­ä¹Ÿéœ€è¦ä¸€äº› `v-if` `v-for` çš„æ•°æ®æ˜¯æ¥æºå…¨å±€çš„ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸ºäº†é¿å…é‡å¤è®¡ç®—ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªä¸´æ—¶å˜é‡ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ç°çš„ä»£ç ï¼š

å…ˆæ˜¯åœ¨çˆ¶ç»„ä»¶ä¸­ï¼š

```jsx
<Functional :name="name" />
<TempVar
  :var1="`hello ${name}`"
  :var2="destroyClock ? 'hello vue' : 'hello world'"
  >
  <template v-slot="{ var1, var2 }">
    {{ var1 }}
    {{ var2 }}
  </template>
</TempVar>
```

ç„¶åæ˜¯ `Functional` ç»„ä»¶ï¼š

```jsx
<template functional>
  <div>
    {{ props }}
  </div>
</template>
```

- å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ `.vue` çš„å•æ–‡ä»¶ç»„ä»¶æ—¶ï¼Œåªéœ€è¦åœ¨ `template` ä¸­æ·»åŠ  `functional` å±æ€§å°±è¡Œã€‚

æœ€åæ˜¯ `TempVar` ç»„ä»¶ï¼š

```jsx
export default {
  functional: true,
  render: (h, ctx) => {
    return ctx.scopedSlots.default && ctx.scopedSlots.default(ctx.props || {});
  }
};
```

- é¦–å…ˆè¦è¯´æ˜çš„æ˜¯ï¼Œ`TempVar` ç»„ä»¶å®é™…ä¸Šæ˜¯ `.js` æ–‡ä»¶è€Œé `.vue` æ–‡ä»¶
- éœ€è¦åœ¨è¿”å›çš„å¯¹è±¡ä¸­æ·»åŠ  `functional: ture` çš„å±æ€§
- æ·»åŠ  `render` æ–¹æ³•ï¼Œè¿™é‡Œæ‰€åšçš„å¤„ç†æ˜¯ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æœ‰ scopedSlots ä¸º default çš„æ’æ§½ï¼Œå¦‚æœæœ‰åˆ™æˆ‘ä»¬å°±å‘è¯¥é»˜è®¤æ’æ§½æ·»åŠ å‡½æ•°ç»„ä»¶æ‰€è·å¾—çš„æ‰€æœ‰ propsï¼Œä¹Ÿå°±æ˜¯å°† props è¿”å›ç»™ä½äºçˆ¶ç»„ä»¶ä¸­çš„è°ƒç”¨æ–¹ã€‚
- å› æ­¤ï¼Œå›åˆ°çˆ¶ç»„ä»¶ä»£ç ä¸­ï¼Œåœ¨ç¬¬ 3 å’Œ 4 è¡Œæˆ‘ä»¬å‘å‡½æ•°ç»„ä»¶ä¼ å…¥äº†ä¸¤ä¸ª prop var1 å’Œ var2ï¼Œç„¶ååœ¨ `<template>` å’Œå…¶ `default slot` ï¼ˆä½œç”¨åŸŸæ’æ§½ï¼‰ä¸­é€šè¿‡ `v-slot={ var1, var2 }` è§£æ„è¿”å›è¿™ä¸¤ä¸ª propï¼ˆå½“ç„¶å­ç»„ä»¶å†…éƒ¨ä¹Ÿéœ€è¦ä¼ é€’ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™ var1 å’Œ var2 å°±æˆä¸ºäº†æˆ‘ä»¬çš„**ä¸´æ—¶å˜é‡**ï¼Œåœ¨ `<template>` ä¸­å¯ä»¥éšæ—¶ä½¿ç”¨ã€‚

### è¯¾åä¹ é¢˜

> è®¾è®¡ä¸€ä¸ªç§’æ€å€’è®¡æ—¶ç»„ä»¶



## 14 | æŒ‡ä»¤çš„æœ¬è´¨æ˜¯ä»€ä¹ˆ

å¦‚æœç»å¸¸ä½¿ç”¨ `<template>` è¯­æ³•ï¼Œåˆ™ä¼šç»å¸¸ä½¿ç”¨æŒ‡ä»¤ï¼›å¦‚æœä½¿ç”¨ render å‡½æ•°ä¸ JSX çš„è¯ï¼Œåˆ™æŒ‡ä»¤å°±ä¸ä¼šæ˜¾çš„é‚£ä¹ˆå¸¸ç”¨ã€‚



### å†…ç½®æŒ‡ä»¤ - 14 ç§

- v-text
- v-html
- v-show
- v-if
- v-else
- v-else-if
- v-for
- v-on
- v-bind
- v-model
- v-slot
- v-pre
- v-cloak
- V-once

æŒ‡ä»¤å®é™…ä¸Šæ˜¯ä¸€ç§è¯­æ³•ç³–ã€æ ‡å¿—ä½ï¼Œå½“å¤„äºç¼–è¯‘é˜¶æ®µæ—¶ï¼Œä» `<template>` ç¼–è¯‘åˆ° `render` å‡½æ•°æ—¶ï¼Œä¼šæŠŠè¿™äº›è¯­æ³•ç³–ç¼–è¯‘ä¸º js ä»£ç ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ `render` å‡½æ•°ä¸ JSX å¹¶ä¸æ”¯æŒå†…ç½®æŒ‡ä»¤çš„åŸå› ã€‚

ä¸è¿‡æŒ‡ä»¤ç¡®å®èƒ½å¤Ÿç®€åŒ–æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹ï¼Œå¹¶ä¸” JSX ä¹Ÿæ˜¯è¯­æ³•ç³–ï¼Œæ‰€ä»¥ JSX ä¹Ÿåœ¨é€æ¸çš„å¼€å§‹æ”¯æŒæŒ‡ä»¤ã€‚

### demo

> æ¼”ç¤º DEMO æºç  /src/views/1.7

æˆ‘ä»¬å…ˆä»ä»£ç ä¸­æ¥çœ‹ä¸€çœ‹è¿™äº›æŒ‡ä»¤çš„ä½¿ç”¨å’Œä½œç”¨ï¼š

**v-textï¼š**

```jsx
<div v-text="'hello vue'">hello world</div>
```

- æˆ‘ä»¬ä½¿ç”¨ `v-text` ä¼ å…¥äº† `'hello vue'` å­—ç¬¦ä¸²ï¼Œç„¶ååœ¨ `div` å…ƒç´ çš„å†…å®¹ä¸­æ·»åŠ äº† `hello world` çš„å†…å®¹ï¼Œæœ€ç»ˆ `v-text` çš„å€¼ä¼šæ›¿æ¢æ‰ `div` å…ƒç´ ä¸­çš„æ‰€æœ‰å†…å®¹

**v-htmlï¼š**

```jsx
<div v-html="'<span style=&quot;color: red&quot;>hello vue</span>'">
  hello world
</div>
```

- ä¸ `v-text` ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯å…¶ä¸­å†…å®¹ä¸­çš„ html ä¼šè¢«è½¬æ¢ä¸º html ä»£ç ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²
- å½“ç„¶ç”±äºå¯ä»¥å†™å…¥ htmlï¼Œæ‰€ä»¥å­˜åœ¨ XSS é£é™©

**v-showï¼š**

```jsx
<div v-show="show">hello vue</div>
<button @click="show = !show">change show</button>
```

- æ ¹æ®ä¼ å…¥ `v-show` ä¸­çš„å€¼æ¥åˆ¤æ–­æ­¤èŠ‚ç‚¹æ˜¯å¦æ˜¾ç¤º
- ä½†ä¸ `v-if` çš„ä¸åŒç‚¹åœ¨äºå…¶æ˜¯é€šè¿‡ `display: none` æ¥ä½¿èŠ‚ç‚¹ä¸æ˜¾ç¤ºï¼Œå…¶ä¾ç„¶å­˜åœ¨ä¸ DOM ä¹‹ä¸­

**v-if | v-else-if | v-elseï¼š**

```jsx
<div v-if="number === 1">hello vue {{ number }}</div>
<div v-else-if="number === 2">hello world {{ number }}</div>
<div v-else>hello geektime {{ number }}</div>
```

- ä¸‰ä¸ªæŒ‡ä»¤æ˜¯ç›¸äº’é…åˆçš„ï¼Œä¸” `v-else-if` å’Œ `v-else` æ˜¯ä¸èƒ½å•ç‹¬å­˜åœ¨çš„ï¼Œéœ€è¦å’Œ `v-if` ä¸€èµ·ä½¿ç”¨ã€‚
- è¿™ä¸‰ä¸ªæŒ‡ä»¤å’Œ JS è¯­è¨€ä¸­çš„åˆ¤æ–­è¯­å¥æ˜¯ç›¸ä¼¼çš„
- å®ƒä¼šç›´æ¥å°†å…ƒç´ èŠ‚ç‚¹ä» DOM ä¸­ç§»é™¤

**v-for | v-bindï¼š**

```jsx
<div v-for="num in [1, 2, 3]" v-bind:key="num">hello vue {{ num }}</div>
```

- `v-for` å®é™…ä¸Šå°±æ˜¯ for å¾ªç¯
- `v-bind` çš„ç®€å†™æ˜¯ `:` ï¼Œå¯¹äºæˆ‘è€Œè¨€ï¼Œå°±æ˜¯å¯ä»¥ä½¿ç”¨ JS è¡¨è¾¾å¼çš„æ–¹å¼æ¥ä¼ å€¼

**v-onï¼š**

```jsx
<button v-on:click="number = number + 1">number++</button>
```

- `v-on` ç»‘å®šäº‹ä»¶ï¼Œç®€å†™ä¸º `@`

**v-modelï¼š**

```jsx
<input v-model="message" />
```

- `v-model` æ˜¯åŒå‘ç»‘å®šçš„è¯­æ³•ç³–

**v-preï¼š**

```jsx
<div v-pre>{{ this will not be compiled }}</div>
```

- `v-pre` åœ¨å¼€å‘ä¸­å¾ˆå°‘ç”¨åˆ°ï¼Œå› ä¸º `{{}}` åŒæ‹¬å·çš„å†™æ³•åœ¨ vue ä¸­æ˜¯å…·æœ‰ç‰¹æ®Šæ„ä¹‰çš„ï¼Œä¼šå°†å…¶ä¸­çš„å†…å®¹è®¤ä¸ºæ˜¯è¡¨è¾¾å¼è¿›è¡Œç¼–è¯‘ï¼Œè€Œä½¿ç”¨ `v-pre` åˆ™ä¼šç»•å¼€ç¼–è¯‘è¿‡ç¨‹è€Œç›´æ¥è¾“å‡ºå­—ç¬¦ä¸²ã€‚

**v-onceï¼š**

```jsx
<div v-once>
  {{ number }}
</div>
```

- `v-once` åœ¨å¹³æ—¶çš„å¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿå¾ˆå°‘ä½¿ç”¨ï¼Œå¯¹äºä½¿ç”¨ `v-once` çš„å…ƒç´ ï¼Œå…¶å†…å®¹ä¸­çš„å˜é‡åªä¼šä½¿ç”¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶çš„å€¼ï¼Œå¯¹äºä¹‹åå¦‚æœå“åº”å¼å˜é‡å‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚

**v-cloakï¼š**

- ä½¿ç”¨æœ€å°‘çš„å†…ç½®æŒ‡ä»¤ï¼Œå¹¶ä¸”ä¸èƒ½åœ¨ template ä¸­ä½¿ç”¨ã€‚



### è‡ªå®šä¹‰æŒ‡ä»¤

é™¤äº†å†…ç½®æŒ‡ä»¤ä¹‹å¤–ï¼Œvue ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å¯ä»¥è‡ªå®šä¹‰æŒ‡ä»¤çš„åŠŸèƒ½ã€‚

è‡ªå®šä¹‰æŒ‡ä»¤å¹¶ä¸æ˜¯ä¸€ä¸ªåˆšæ€§éœ€æ±‚ï¼Œå› ä¸ºè‡ªå®šä¹‰æŒ‡ä»¤èƒ½å¤Ÿå®Œæˆçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡å…¶ä»–çš„æ–¹å¼å»å®ç°ã€‚æ¯”å¦‚è¯´ `v-show` è¿™ä¸ªæŒ‡ä»¤ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶çš„å†…éƒ¨é€šè¿‡åˆ¤æ–­ä¸€ä¸ªçŠ¶æ€æ¥æ·»åŠ ä¸€äº›é€»è¾‘æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½†è¿™å­˜åœ¨ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚æœå…¶ä»–ç»„ä»¶ä¹Ÿä¹Ÿæƒ³è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œåˆ™å…¶ä»–ç»„ä»¶ä¹Ÿä¾ç„¶éœ€è¦æ·»åŠ è¿™äº›é€»è¾‘ï¼Œä¼šä½¿ä»£ç å˜å¾—æ›´åŠ å†—ä½™ã€‚æ‰€ä»¥ï¼ŒæŒ‡ä»¤ç»™æˆ‘ä»¬å¸¦æ¥çš„å¥½å¤„å°±æ˜¯æŠ½è±¡ä»£ç ï¼Œä½¿ä»£ç æ›´åŠ çš„ç®€æ´ã€‚

vue ä¸ºæˆ‘ä»¬æš´éœ²äº†è‡ªå®šä¹‰æŒ‡ä»¤çš„äº”ä¸ªé’©å­å‡½æ•°ï¼š

- bind
- inserted
- update
- componentUpdated
- unbind

è¿™å®é™…ä¸Šå°±æ˜¯è‡ªå®šä¹‰æŒ‡ä»¤çš„ç»„æˆï¼Œå’Œç”Ÿå‘½å‘¨æœŸæœ‰å¾ˆå¤§çš„å…³ç³»ã€‚æˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™äº›é’©å­ä¸­åšä¸€äº›é€»è¾‘æ“ä½œï¼Œç„¶ååœ¨æ¨¡ç‰ˆä¸­ä½¿ç”¨ï¼Œæ¥çœ‹ä¸€ä¸‹ demoï¼š

```jsx
<template>
  <div>
    <button @click="show = !show">
      é”€æ¯
    </button>
    <button v-if="show" v-append-text="`hello ${number}`" @click="number++">
      æŒ‰é’®
    </button>
  </div>
</template>
<script>
export default {
  directives: {
    appendText: {
      bind() {
        console.log("bind");
      },
      inserted(el, binding) {
        el.appendChild(document.createTextNode(binding.value));
        console.log("inserted", el, binding);
      },
      update() {
        console.log("update");
      },
      componentUpdated(el, binding) {
        el.removeChild(el.childNodes[el.childNodes.length - 1]);
        el.appendChild(document.createTextNode(binding.value));
        console.log("componentUpdated");
      },
      unbind() {
        console.log("unbind");
      }
    }
  },
  data() {
    return {
      number: 1,
      show: true
    };
  }
};
</script>
```

- è¿™æ˜¯ä¸€ä¸ªä½äºç»„ä»¶å†…çš„å±€éƒ¨æŒ‡ä»¤ï¼Œå¦‚æœæƒ³è¦æ³¨å†Œä¸€ä¸ªå…¨å±€æŒ‡ä»¤è¯·ä½¿ç”¨ `Vue.directive`
- åœ¨ `directives` å­—æ®µä¸­ï¼Œæ·»åŠ å±æ€§ï¼Œå±æ€§åä¸ºæŒ‡ä»¤åç§°ï¼Œæ¯”å¦‚è¿™é‡Œçš„ `appendText` ï¼Œåˆ™åœ¨æ¨¡ç‰ˆä¸­å°±é€šè¿‡ `v-append-text` æ¥ä½¿ç”¨
- åœ¨æŒ‡ä»¤å±æ€§ä¸­è®¾ç½®é’©å­å‡½æ•°ï¼Œé’©å­å‡½æ•°ä¼šåœ¨ç»„ä»¶åˆ›å»ºã€æ›´æ–°ã€é”€æ¯çš„è¿‡ç¨‹ä¸­è°ƒç”¨ã€‚
- `v-apped-text` æŒ‡ä»¤çš„åŠŸèƒ½æ˜¯å°†ä¼ å…¥æŒ‡ä»¤çš„æ–‡æœ¬æ·»åŠ åˆ°å…ƒç´ å†…å®¹çš„åé¢ã€‚



### è¯¾åä¹ é¢˜

> æŸ¥çœ‹ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå’ŒæŒ‡ä»¤å‘¨æœŸé’©å­çš„è¿è¡Œé¡ºåº
>
> äº†è§£ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå’ŒæŒ‡ä»¤ç”Ÿå‘½å‘¨æœŸå…³ç³»

> ```js
> 
> ----------------
> create stage
> ----------------
> beforeCreate
> data
> created
> beforeMount
> render
> d-bind
> mounted
> d-inserted
> ----------------
> update stage
> ----------------
> d-update
> d-componentUpdated
> beforeUpdate
> render
> updated
> ------------------
> destory stage
> ------------------
> beforeDestroy
> destroyed
> d-unbind
> ```



## 15 | å¸¸ç”¨é«˜çº§ç‰¹æ€§ provide/inject

provide/inject åœ¨å¹³æ—¶çš„ä¸šåŠ¡å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½å¾ˆå°‘ç”¨åˆ°ï¼Œä½†å¦‚æœè¦å»å¼€å‘åº•å±‚çš„ä¸šåŠ¡ç»„ä»¶åˆ™ä½¿ç”¨é¢‘ç‡ç›¸å½“é«˜ï¼Œå…¶ä¸»è¦è§£å†³çš„ä¾ç„¶æ˜¯ç»„ä»¶é—´çš„é€šä¿¡é—®é¢˜ã€‚

### ç»„ä»¶é€šä¿¡

![image-20190615223224998](assets/image-20190615223224998.png)

å¦‚ä¸Šæ ‘å½¢ç»“æ„ï¼Œçˆ¶å­ç»„ä»¶é—´çš„é€šä¿¡ï¼Œæ¯”å¦‚ A ä¸ Bï¼Œé€šå¸¸æ˜¯ A èŠ‚ç‚¹é€šè¿‡ props ä¼ é€’æ•°æ®ç»™ Bï¼ŒB é€šè¿‡è§¦å‘äº‹ä»¶ `this.$emit` æ¥ä¼ é€’æ•°æ®ã€‚é‚£å¦‚æœæ˜¯ A å‘ E ä¼ é€’æ•°æ®ï¼Œåˆ™éœ€è¦ä½¿ç”¨ props é€šè¿‡ A å‘ C ä¼ é€’ä¹‹åå†å‘ E ä¼ é€’æ•°æ®ï¼Œè¿™æ ·çš„ä¼ é€’è¿˜å¹¶ä¸å¤æ‚ï¼Œå¦‚æœæ˜¯ E è¦å‘ I ä¼ é€’æ•°æ®ï¼Œé™¤äº†è¦ä½¿ç”¨ prop ä¹‹å¤–ï¼Œè¿˜éœ€è¦é€šè¿‡äº‹ä»¶æ¥ä¸€å±‚ä¸€å±‚çš„ä¼ é€’æ•°æ®æ¥è¿›è¡Œé€šä¿¡ï¼Œè¿™æ ·çš„æˆæœ¬æ˜¯éå¸¸é«˜çš„ï¼Œè€Œä¸”æ²¡æœ‰ä»€ä¹ˆå¥å£®æ€§å¯è¨€ï¼Œéå¸¸çš„è„†å¼±ï¼Œprovide/inject å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

> [è®¡ç®—æœºç§‘å­¦](https://www.wikiwand.com/zh-hans/è®¡ç®—æœºç§‘å­¦)ä¸­ï¼Œ**å¥å£®æ€§**ï¼ˆè‹±è¯­ï¼šRobustnessï¼‰æ˜¯æŒ‡ä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¤„ç†é”™è¯¯ï¼Œä»¥åŠç®—æ³•åœ¨é­é‡è¾“å…¥ã€è¿ç®—ç­‰å¼‚å¸¸æ—¶ç»§ç»­æ­£å¸¸è¿è¡Œçš„èƒ½åŠ›ã€‚ è¯¸å¦‚[æ¨¡ç³Šæµ‹è¯•](https://www.wikiwand.com/zh-hans/æ¨¡ç³Šæµ‹è¯•)ä¹‹ç±»çš„[å½¢å¼åŒ–æ–¹æ³•](https://www.wikiwand.com/zh-hans/å½¢å¼åŒ–æ–¹æ³•)ä¸­ï¼Œå¿…é¡»é€šè¿‡åˆ¶é€ é”™è¯¯çš„æˆ–ä¸å¯é¢„æœŸçš„è¾“å…¥æ¥éªŒè¯ç¨‹åºçš„å¥å£®æ€§ã€‚å¾ˆå¤šå•†ä¸šäº§å“éƒ½å¯ç”¨æ¥æµ‹è¯•è½¯ä»¶ç³»ç»Ÿçš„å¥å£®æ€§ã€‚å¥å£®æ€§ä¹Ÿæ˜¯[å¤±æ•ˆè¯„å®š](https://www.wikiwand.com/zh-hans/å¤±æ•ˆè¯„å®š)åˆ†æä¸­çš„ä¸€ä¸ªæ–¹é¢ã€‚

provide æä¾›æ•°æ®ï¼ˆæ¯”å¦‚è¿™é‡Œçš„ A èŠ‚ç‚¹ï¼‰ï¼Œinject æ³¨å…¥æ•°æ®ï¼ˆæ¯”å¦‚è¿™é‡Œçš„ E F Iï¼‰

### demo

> æ¼”ç¤º DEMO æºç  /src/views/1.8

demo éƒ¨åˆ†å°±æ˜¯æ¨¡æ‹Ÿä¸Šé¢çš„æ ‘å½¢ç»“æ„ã€‚å…ˆæ”¾åœ¨è¿™é‡Œå§ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¹Ÿéƒ½ä¼šä½¿ç”¨ vuexã€‚

### è¯¾åä¹ é¢˜

> æˆ‘ä»¬æä¾›æ•°æ®æ—¶ï¼Œæ˜¯é€šè¿‡å“åº”å¼æ•°æ®ï¼Œthis æ¥ä¼ é€’çš„ï¼Œè¿™æ ·æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œthis ä¸‹ä¼šæŒ‚è½½ä¸€äº›å¹¶ä¸éœ€è¦çš„æ•°æ®ï¼Œé‚£ä¹ˆå¦‚æœæŒ‰éœ€çš„æä¾›å“åº”å¼æ•°æ®å‘¢ï¼Ÿ
>
> å¯ä»¥ä½¿ç”¨ 2.6 æœ€æ–° API Vue.obserbvable ä¼˜åŒ–å“åº”å¼ provide



## 16 | å¦‚ä½•ä¼˜é›…åœ°è·å–è·¨å±‚çº§ç»„ä»¶å®ä¾‹ï¼ˆæ‹’ç»é€’å½’ï¼‰

ä¸ŠèŠ‚è¯¾æˆ‘ä»¬æ‰€è®²çš„æ˜¯ç»„ä»¶ä¹‹é—´å¦‚ä½•è·¨å±‚çº§é€šä¿¡çš„é—®é¢˜ï¼Œè¿™èŠ‚è¯¾åˆ™æ˜¯è®²ç»„ä»¶ä¹‹é—´å¦‚ä½•è·¨å±‚çº§çš„è·å¾—å®ä¾‹ã€‚

### ä»€ä¹ˆæ˜¯ç»„ä»¶å®ä¾‹

ç»„ä»¶åœ¨æ¸²æŸ“å®Œæˆä¹‹åéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå®ä¾‹ï¼Œå°±åƒåœ¨ JS ä¸­ new ä¸€ä¸ªå¯¹è±¡ã€‚

ç†æƒ³çŠ¶æ€ä¸‹æˆ‘ä»¬å¹¶ä¸éœ€è¦è®¿é—®è¿™ä¸ªå®ä¾‹ï¼Œè€Œåªéœ€è¦å…³æ³¨æ•°æ®å°±å¯ä»¥äº†ã€‚å¯éšç€ä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚ï¼Œéš¾å…ä¼šè®¿é—® vue å®ä¾‹çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ echartï¼Œä¸€ä¸ªä¸šç•Œå¾ˆæœ‰åçš„æ•°æ®å¯è§†åŒ–çš„åº“ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ echart å°±å¾ˆéš¾é¿å…ä¸å»ä½¿ç”¨ç»„ä»¶å®ä¾‹çš„æƒ…å†µï¼›å†æ¯”å¦‚æˆ‘ä»¬çš„ input èŠ‚ç‚¹ï¼Œéœ€è¦æ‰‹åŠ¨çš„è§¦å‘å®ƒçš„ focus çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™ä¾ç„¶éœ€è¦å»è®¿é—®æˆ‘ä»¬çš„å®ä¾‹ã€‚

åŸºäºè¿™äº›æƒ…å†µï¼Œvue æä¾›ç»™äº†æˆ‘ä»¬è®¿é—® vue å®ä¾‹çš„ APIï¼Œä¹Ÿå°±æ˜¯ ref

### ref å¼•ç”¨ä¿¡æ¯

æˆ‘ä»¬å¯ä»¥é€šè¿‡  `this.$refs.xxx` æˆ–æ˜¯ `vm.$refs.xxx` æ¥è®¿é—®åˆ°æˆ‘ä»¬çš„å®ä¾‹ï¼Œå¦‚ä¸‹ï¼š

```html
<!-- `vm.$refs.p` will be the DOM node -->
<p ref="p">hello</p>

<!-- `vm.$refs.child` will be the child component instance -->
<child-component ref="child"></child-component>
```

- å°±å¦‚æ³¨é‡Šæ‰€æè¿°çš„ï¼Œå½“æˆ‘ä»¬é€šè¿‡ `$refs` æ¥è·å–å…ƒç´ æ—¶åˆ™ä¸º DOM èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯ç»„ä»¶åˆ™æ˜¯ç»„ä»¶å®ä¾‹ã€‚

é€šè¿‡ `this.$refs.xxx` å¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å–åˆ°å½“å‰ç»„ä»¶ä¸Šä¸‹æ–‡çš„å®ä¾‹ï¼Œä½†å¦‚æœæƒ³è¦è·å–è·¨å±‚çº§çš„ç»„ä»¶å®ä¾‹åˆ™éå¸¸çš„ä¸æ–¹ä¾¿ï¼Œå¯¹äºæƒ³è¦è·å–çˆ¶ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ parentï¼Œå­ç»„ä»¶å¯ä»¥é€šè¿‡ childï¼Œä½†å¦‚æœå±‚çº§åˆåå‡ çº§åˆ™éå¸¸çš„ä¸æ–¹ä¾¿ã€‚

### é€’å½’æŸ¥æ‰¾

![image-20190616160108838](assets/image-20190616160108838.png)

æ¯”å¦‚ä¸Šå›¾è¿™ç§æƒ…å†µï¼ŒA èŠ‚ç‚¹æƒ³è¦è·å– Eï¼ŒF æƒ³è¦è·å– A å’Œ Dï¼Œè¿™ç§æƒ…å†µå¯èƒ½éœ€è¦æˆ‘ä»¬ä½¿ç”¨é€’å½’çš„æ–¹å¼å»æŸ¥çœ‹ï¼Œå¹¶ä¸”å¾ˆå¤šå¼€æºé¡¹ç›®ä¹Ÿæ˜¯è¿™æ ·å»åšçš„ï¼Œä½†æ˜¯è¿™æ ·å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼š

- ä»£ç ç¹ç
- æ€§èƒ½ä½æ•ˆ
  - å› ä¸ºæ— æ³•è¢«ç¼“å­˜ï¼Œåˆ™æ¯ä¸€æ¬¡ä½¿ç”¨éƒ½éœ€è¦å»é‡æ–°æŸ¥æ‰¾

### callback ref

React ä¸­çš„ ref æ˜¯å¯ä»¥é€šè¿‡å›è°ƒæ¥è·å–çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯ä»¥åœ¨å›è°ƒä¸­åšå¾ˆå¤šäº‹æƒ…ï¼Œå°±ç›¸å¯¹æ¯”è¾ƒçµæ´»ã€‚é‚£ä¹ˆåœ¨ vue ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§æ–¹æ¡ˆï¼š

- ä¸»åŠ¨é€šçŸ¥ï¼ˆsetXxxRefï¼‰ï¼ˆåç§°æ˜¯å¯ä»¥éšæ„å–çš„ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼‰
- ä¸»åŠ¨è·å–ï¼ˆgetXxxRefï¼‰

å‡å¦‚ A è¦è·å– E çš„å®ä¾‹ï¼Œåˆ™ A åªéœ€è¦æä¾›ä¸€ä¸ªé’©å­å‡½æ•°ï¼ŒE ç”Ÿæˆæˆ–è€…æ›´æ–°ä¹‹åä¸»åŠ¨çš„è°ƒç”¨è¿™ä¸ªé’©å­å‡½æ•°æ¥é€šçŸ¥ A èŠ‚ç‚¹ï¼Œæˆ‘è¿™ä¸ªå®ä¾‹å·²ç»ç”Ÿæˆå¥½äº†ï¼ŒA èŠ‚ç‚¹åˆ™å°†è¿™ä¸ªå®ä¾‹è¿›è¡Œç¼“å­˜ï¼ŒA èŠ‚ç‚¹è®¿é—® E çš„æ—¶å€™æ€»æ˜¯èƒ½å¤Ÿæ‹¿åˆ°æœ€æ–°çš„ï¼Œå› ä¸º E èŠ‚ç‚¹æ›´æ–°ä¹‹åä¼šä¸»åŠ¨å‘Šè¯‰ A èŠ‚ç‚¹ã€‚è¿™å°±æ˜¯æ•´ä¸ªæ–¹æ³•çš„è¿‡ç¨‹ã€‚

é‚£ä¹ˆå¦‚ä½•å®ç° callback ref åˆ™æˆä¸ºäº†ä¸€ä¸ªæ–°çš„éš¾ç‚¹ã€‚å…ˆæ¥çœ‹çœ‹ demo

### demo

> æ¼”ç¤º DEMO æºç  /src/views/1.9

èŠ‚ç‚¹å’Œä¸Šé¢å›¾ç¤ºä¸­æ˜¯ç›¸åŒçš„ã€‚

A èŠ‚ç‚¹ï¼š

```jsx
export default {
  components: {
    ChildrenB,
    ChildrenC,
    ChildrenD
  },
  provide() {
    return {
      setChildrenRef: (name, ref) => {
        this[name] = ref;
      },
      getChildrenRef: name => {
        return this[name];
      },
      getRef: () => {
        return this;
      }
    };
  },
  data() {
    return {
      color: "blue"
    };
  },
  methods: {
    getEH3Ref() {
      console.log(this.childrenE);
    }
  }
};
```

- A èŠ‚ç‚¹ä¸­ä½¿ç”¨ `provide` å­—æ®µæä¾› `setChildrenRef` æ–¹æ³•ç”¨äºç¼“å­˜ï¼Œæä¾› `getChildrenRef` ç”¨äºè·å–
- åœ¨ 26 è¡Œä¸­å¯ä»¥é€šè¿‡ `getEH3Ref` æ–¹æ³•æ¥è·å¾—ä» E èŠ‚ç‚¹ä¼ é€’è¿‡æ¥çš„ ref
- æ³¨æ„ `provide` ä¸­æä¾›çš„å‡½æ•°éƒ½æ˜¯ç®­å¤´å‡½æ•°ï¼Œæ‰€ä»¥å…¶ä¸­çš„ this å®é™…ä¸Šæ˜¯ A çš„å®ä¾‹

```jsx
<template>
  <div class="border2">
    <h3 v-ant-ref="c => setChildrenRef('childrenE', c)">
      E ç»“ç‚¹
    </h3>
  </div>
</template>
<script>
export default {
  components: {},
  inject: {
    setChildrenRef: {
      default: () => {}
    }
  }
};
</script>
```

- ç„¶ååœ¨éœ€è¦è·å–çš„èŠ‚ç‚¹å¤„ï¼Œé€šè¿‡ `inject` æ¥æ”¶åˆ° `setChildrenRef` æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ `v-ant-ref` æŒ‡ä»¤ï¼Œåœ¨è¿™ä¸ªæŒ‡ä»¤ä¸­ä¼ å…¥ä¸€ä¸ªå›è°ƒï¼Œå›è°ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°åˆ™æ˜¯æ­¤å…ƒç´ çš„å¼•ç”¨ï¼Œç„¶åå°†å‚æ•°ä¼ å…¥ `setChildrenRef` ä¹‹ä¸­å³å¯ã€‚

å†æ¥çœ‹çœ‹ F èŠ‚ç‚¹çš„ä»£ç ï¼š

```jsx
<template>
  <div class="border2">
    <h3>F ç»“ç‚¹</h3>
    <button @click="getARef">è·å–A Ref</button>
    <button @click="getHRef">è·å–H Ref</button>
  </div>
</template>
<script>
export default {
  components: {},
  inject: {
    getParentRef: {
      from: "getRef",
      default: () => {}
    },
    getParentChildrenRef: {
      from: "getChildrenRef",
      default: () => {}
    }
  },
  methods: {
    getARef() {
      console.log(this.getParentRef());
    },
    getHRef() {
      console.log(this.getParentChildrenRef("childrenH"));
    }
  }
};
</script>
```

- æ³¨å…¥äº† `getRef` æ–¹æ³•å’Œ `getChildrenRef` æ–¹æ³•ï¼ˆè¿™é‡Œå·²ç»æ›´æ¢åç§°ï¼‰
- `getRef` å½“ç„¶å¯ä»¥ç›´æ¥è·å–åˆ° A èŠ‚ç‚¹
- `getChildrenRef` åˆ™æ˜¯é€šè¿‡åœ¨ D èŠ‚ç‚¹ä¸­ä½¿ç”¨ `setChildrenRef` æ¥å­˜å‚¨äº† H åŠè¯¶ä½†ä»è€Œå¯ä»¥è·å–ã€‚

D èŠ‚ç‚¹ä»£ç ï¼š

```jsx
<template>
  <div class="border1">
    <h2>D ç»“ç‚¹</h2>
    <ChildrenG />
    <ChildrenH v-ant-ref="c => setChildrenRef('childrenH', c)" />
    <ChildrenI />
  </div>
</template>
<script>
import ChildrenG from "./ChildrenG";
import ChildrenH from "./ChildrenH";
import ChildrenI from "./ChildrenI";
export default {
  components: {
    ChildrenG,
    ChildrenH,
    ChildrenI
  },
  inject: {
    setChildrenRef: {
      default: () => {}
    }
  }
};
</script>
```

- ç¬¬ 5 è¡Œä¸­é€šè¿‡ `setChildrenRef` å°† `ChildrenH` ç»„ä»¶å­˜å‚¨åœ¨äº† A èŠ‚ç‚¹ä¹‹ä¸­ã€‚

æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•çš„åŸç†æ˜¯ï¼Œé€šè¿‡å°†å…¶ä»–èŠ‚ç‚¹ä½¿ç”¨ `v-ant-ref` æŒ‡ä»¤å°†å…¶å­˜å‚¨åˆ°æ ¹èŠ‚ç‚¹ä¹‹ä¸‹ï¼Œç„¶åé€šè¿‡æ ¹èŠ‚ç‚¹æ‰€æä¾›çš„æ–¹æ³•åœ¨å…¶ä»–ç»„ä»¶ä¸­è·å–æƒ³è¦è·å–çš„èŠ‚ç‚¹ã€‚

### è¯¾åä¹ é¢˜

> v-ant-ref æŒ‡ä»¤å›è°ƒä¸­èƒ½å¦æ›´æ”¹å“åº”å¼æ•°æ®ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
>
> ä¼šä¸åœè§¦å‘updateå›è°ƒã€‚





## 17 | template å’Œ JSX çš„å¯¹æ¯”ä»¥åŠå®ƒä»¬çš„æœ¬è´¨

JSX æ˜¯ä¼´éšç€ React è¯ç”Ÿçš„ï¼Œä¸è¿‡ React å’Œ JSX å¯ä»¥è¯´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ä¸ªä½“ï¼Œé€šè¿‡ä¸€äº›æ’ä»¶çš„å½¢å¼ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥åœ¨ vue ä¸­ä½¿ç”¨ JSXã€‚

### template

- æ¨¡ç‰ˆè¯­æ³•ï¼ˆHTML çš„æ‰©å±•ï¼‰
- æ•°æ®ç»‘å®šä½¿ç”¨ Mustache è¯­æ³•ï¼ˆåŒå¤§æ‹¬å·ï¼‰ï¼ˆJQuery ç”¨çš„å¾ˆå¤šï¼‰

```jsx
<span>Message: {{ msg }}</span>
```

### JSX

- JavaScript çš„è¯­æ³•æ‰©å±•
- æ•°æ®ç»‘å®šä½¿ç”¨å•å¼•å·

```jsx
<span>Message: {this.msg}</span>
```

ä»ä¸Šé¢ç¤ºä¾‹æ¥çœ‹ï¼Œä¼¼ä¹ template ä¸ JSX æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ï¼Œå¯ JSX æ˜¯ JS çš„æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­å†™å„ç§ JS çš„é€»è¾‘ï¼Œæ‰€ä»¥ç›¸æ¯”äº template æ¥è¯´å°±ä¼šæ›´åŠ çš„çµæ´»ã€‚

### template vs JSX

![image-20190616171244964](assets/image-20190616171244964.png)

ä¸€ä¸ªæ¡†æ¶çš„æ¨å‡ºå¿…ç„¶éœ€è¦ä¸€äº›ç‰¹ç‚¹æ¥å¸å¼•ç”¨æˆ·çš„ä½¿ç”¨ï¼Œè€Œ tempalte å°±æ˜¯ vue çš„ä¸€å¤§ç‰¹ç‚¹ã€‚

ä½†ä¸ºä»€ä¹ˆéœ€è¦ JSXï¼ŒåŸå› åœ¨äºï¼Œè™½ç„¶æˆ‘ä»¬å¼€å‘çš„ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œéš¾å…ä¼šç¢°åˆ°ä¸€äº›é€»è¾‘å¤æ‚çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨ template æ¥å†™é€»è¾‘å°±ä¼šéå¸¸çš„åƒåŠ›ï¼Œè€Œè¿™ä¸ªä½¿ç”¨ JSX æˆ–è€… render æ¸²æŸ“å‡½æ•°å°±ä¼šæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹å¼ã€‚

### demo

> æ¼”ç¤º DEMO æºç  /src/views/1.10

#### **template**

```jsx
<template>
  <h1 v-if="level === 1">
    <slot></slot>
  </h1>
  <h2 v-else-if="level === 2">
    <slot></slot>
  </h2>
  <h3 v-else-if="level === 3">
    <slot></slot>
  </h3>
  <h4 v-else-if="level === 4">
    <slot></slot>
  </h4>
  <h5 v-else-if="level === 5">
    <slot></slot>
  </h5>
  <h6 v-else-if="level === 6">
    <slot></slot>
  </h6>
</template>
<script>
export default {
  props: {
    level: {
      type: Number,
      default: 1
    }
  }
};
</script>
```

- å¦‚æœè¦å®ç°ä¸€ä¸ªæ ¹æ®ä¸€ä¸ª `prop` `level` æ¥æ¸²æŸ“å‡ çº§æ ‡é¢˜ï¼Œä½¿ç”¨ template åˆ™éœ€è¦ä½¿ç”¨åˆ° `v-if` `v-else-if` æ¥é€çº§åˆ¤æ–­ï¼Œä¼šæ¯”è¾ƒéº»çƒ¦ã€‚

#### **JSX**

```jsx
export default {
  props: {
    level: {
      type: Number,
      default: 1
    }
  },
  render: function(h) {
    const Tag = `h${this.level}`;
    return <Tag>{this.$slots.default}</Tag>;
  }
};
```

- ä½¿ç”¨ JSX åˆ™æ˜¯ç›´æ¥åœ¨ `render` å‡½æ•°ä¸­ï¼Œé€šè¿‡å­—ç¬¦ä¸²æ¨¡ç‰ˆæ¥æ‹¼æ¥ä¸€ä¸ªæ ‡ç­¾ï¼Œç„¶åé€šè¿‡æ¸²æŸ“è¿™ä¸ªæ ‡ç­¾å³å¯ï¼Œå¾ˆæ–¹ä¾¿ã€‚

#### JS æ¸²æŸ“å‡½æ•°

```jsx
export default {
  props: {
    level: {
      type: Number,
      default: 1
    }
  },
  render: function(createElement) {
    return createElement(
      "h" + this.level, // æ ‡ç­¾åç§°
      this.$slots.default // å­å…ƒç´ æ•°ç»„
    );
  }
};
```

- æ¸²æŸ“å‡½æ•°åˆ™éœ€è¦æˆ‘ä»¬ä½¿ç”¨åˆ° `createElement` æ–¹æ³•ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥çš„å½¢å¼æ¥ä¼ å…¥éœ€è¦æ¸²æŸ“çš„å…ƒç´ æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯å¦‚æœéœ€è¦æ¸²æŸ“çš„åµŒå¥—è¿‡å¤šå°±ä¼šå¾ˆä¹±ï¼Œå› ä¸ºä¼šä¸æ–­çš„è°ƒç”¨ `createElement` æ–¹æ³•ã€‚

#### Vue æä¾›çš„æ··åˆæ–¹æ³•

```jsx
<template>
  <div>
    <span>Message: {{ msg }}</span>
    <br />
    <VNodes :vnodes="getJSXSpan()" />
    <anchored-heading1 :level="1">Hello world!</anchored-heading1>
    <anchored-heading2 :level="2">Hello world!</anchored-heading2>
    <anchored-heading3 :level="3">Hello world!</anchored-heading3>
    <VNodes :vnodes="getAnchoredHeading(4)" />
  </div>
</template>
<script>
import AnchoredHeading1 from "./AnchoredHeading.vue";
import AnchoredHeading2 from "./AnchoredHeading.js";
import AnchoredHeading3 from "./AnchoredHeading.jsx";

export default {
  components: {
    AnchoredHeading1,
    AnchoredHeading2,
    AnchoredHeading3,
    VNodes: {
      functional: true,
      render: (h, ctx) => ctx.props.vnodes
    }
  },
  data() {
    return {
      msg: "hello vue"
    };
  },
  methods: {
    getJSXSpan() {
      return <span>Message: {this.msg}</span>;
    },
    getAnchoredHeading(level) {
      const Tag = `h${level}`;
      return <Tag>Hello world!</Tag>;
    }
  }
};
</script>
```

- ç¬¬ 5 è¡Œå’Œç¬¬ 9 è¡Œä¸­ï¼Œä½¿ç”¨ `Vnodes` æ ‡ç­¾å¯ä»¥é€šè¿‡å‘ `:vnodes` å±æ€§ä¸­ä¼ å…¥ `JSX` æ¥å®ç°åœ¨ `template` ä¸­ä½¿ç”¨ JSX çš„æ•ˆæœã€‚

åœ¨å¹³å¸¸çš„å¼€å‘è¿‡ç¨‹ä¸­ä¸€å¼€å§‹æˆ‘ä»¬å¯èƒ½éƒ½æ˜¯ä½¿ç”¨ `template`ï¼Œå½“æˆ‘ä»¬é‡åˆ°é€»è¾‘æ¯”è¾ƒå¤æ‚çš„æƒ…å†µæ—¶ï¼Œä¹Ÿä¸ç”¨ç€æ€¥çš„ä½¿ç”¨ JSXï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨ä¸Šé¢è¿™æ ·çš„æ··åˆæ–¹å¼ã€‚

### But è¯­æ³•ç³–

ä¸ç®¡ç”¨ `template` ä¹Ÿå¥½ï¼Œè¿˜æ˜¯ `JSX` ä¹Ÿå¥½ï¼Œå®é™…ä¸Šéƒ½æ˜¯è¯­æ³•ç³–ï¼Œå¦‚å›¾ï¼›

![image-20190616173515223](assets/image-20190616173515223.png)

### è¯¾åä¹ é¢˜

> å°† 1.1 ç« èŠ‚çš„ Demo æ”¹æˆ JSX å½¢å¼ï¼Œä»è€Œè¿›ä¸€æ­¥åŠ æ·±å¯¹ template ä¸ JSX ä¹‹é—´çš„å·®åˆ«ï¼Œæ¯”å¦‚å¦‚ä½•é€šè¿‡ JSX æ¥ä¼ é€’äº‹ä»¶å’Œæ’æ§½ã€‚