# 0. JS Promise 笔记

[TOC]

## 为什么要学习 promise

**因为每个网站开发人员需要能够轻松自信地处理<u>异步操作</u>**

处理异步工作的方法已经有很多，但是在本课程中你将发现 Promise 是被推荐的方法，原因是它更具灵活性和直观的语法，而且还可轻松处理错误。（有时也会阻碍渲染）

## 什么是 promise

Promise 对象用于延迟和异步计算的一种结构。

Promise 并不是安全执行费时操作的通行证，**它仅仅是一种决定异步任务状态确定时会出现什么结果的技术**。将它们想成使用 try catch 将异步操作包裹在里面。

Promise 是一个构造函数，可以像这样将 Promise 存储为一个变量（`var promise = new Promise(funcion(){...})`），或者可以在创建 Promise 后立即使用，无论哪种方式都可以。但你经常会看到，我只是简单地使用 Promise 而不用将它存储为变量。

## 什么是异步操作

**异步操作发生在未知或不可预测的时间，而代码通常是同步的。**同步的是意思是，一个语句之后会到前面语句执行完以后立即执行。

**但处理器上的线程并不能保证这种同步性，但 JavaScript 线程模型可确保对于所有意图和目的 JavaScript 都在一个时间轴上运行。** 

不同于同步代码，异步代码不能保证会在一个不间断的时间轴上执行，其实你应该假设自己不知道什么时候异步操作会完成。

## 什么情况下会有异步

- 网络请求
- 事件
- 线程
- 某种未知的完成时间（可能是指使用 setTimeout 或 setInterval）

## 为什么要使用异步

- 有些操作会非常的耗费时间，比如图片加载或是数据加载，而这往往又会阻碍网页内容的显示，因此我们需要将这些操作放在渲染之后去执行。当然也存在一种情况，费时的操作也关联着内容的渲染，所以也就需要考虑怎么去实现。当然等待的过程中给予用户提示始终是一个非常好的方式。

## 为什么要使用 Promise

- 通常我们在使用异步时会使用回调，但如果每一次的回调之后又需要传入新的回调，那么就会形成“厄运金字塔”，也称为“回调地狱”。Primise 可以解决“回调地狱”。

- 再是，我们使用回调的过程中，可能也需要处理错误，这是我们需要考虑的问题，Promise 可以用于处理当代码发生错误时应该执行什么。

## Promise 有四种状态

- 第一个是成功状态（fulfilled）表示顺利执行与 Promise 相关的操作，也将这个状态称为 resolved
- 第二个是失败状态（rejected）表示与 Promise 相关的操作失败了
- 下一个是初始状态（pending）表示 Promise 尚未成功（fulfilled）或失败（rejected）
- 最后一个是，确定状态（settled），表示 Promise 已经成功或失败

## Promise 的也会出现的问题

在主线程中执行 Promise，这意味着它们仍然可能会造成阻塞，**如果在 Promise 中的操作需要很长时间，那么仍然有可能阻塞浏览器渲染页面所进行的操作：**

Promise 并不是安全执行费时操作的通行证，**它仅仅是一种决定异步任务状态确定时会出现什么结果的技术**。将它们想成使用 try catch 将异步操作包裹在里面。