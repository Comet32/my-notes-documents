# 3.Ajax ä¸ Fetch

> åœ¨è¿™èŠ‚è¯¾ï¼Œä½ è®²ä½¿ç”¨ JavaScript Promise åˆ›å»º fetch è¯·æ±‚å¹¶å¼‚æ­¥åœ°å¤„ç†è¿”å›çš„æ•°æ®ã€‚ä½ è¿˜å°†å­¦ä¹ å¦‚ä½•å¤„ç†å¤±è´¥è¯·æ±‚äº§ç”Ÿçš„é”™è¯¯ã€‚

[TOC]

---

## 3.2 ä»€ä¹ˆæ˜¯ Fetch

Fetch æ˜¯å‘å‡ºç½‘ç»œè¯·æ±‚çš„æ–°æ–¹å¼ï¼åœ¨çœ‹äº†è®¾ç½® `XMLHttpRequest` è¦è¿›è¡Œçš„æ‰€æœ‰æ‰‹åŠ¨è®¾ç½®è¿‡ç¨‹åï¼Œä½ å¯èƒ½è§‰å¾—ï¼ˆåæ­£æˆ‘æ˜¯è§‰å¾—ï¼‰å‘å‡ºç®€å•çš„è¯·æ±‚å´éœ€è¦å¾ˆå¤æ‚çš„æ­¥éª¤ã€‚å¦‚æœæˆ‘åªæƒ³ä» Unsplash è·å–ä¸€å¼ ç…§ç‰‡ï¼Œä¸ºä½•è¦ç”šè‡³åœ¨å‘å‡ºè¯·æ±‚å‰è¿›è¡Œæ‰€æœ‰è¿™äº›è®¾ç½®ï¼Ÿæˆ‘åªéœ€ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œå› æ­¤æˆ‘åªæƒ³è¯·æ±‚è¯¥æ–‡ä»¶ï¼Œè€Œä¸ç”¨å…³å¿ƒæ²¡å¿…è¦è€ƒè™‘çš„å¤æ‚çš„ XHR è§„èŒƒçš„å„ä¸ªç»†èŠ‚éƒ¨åˆ†ã€‚

Fetch æ˜¯ä¸€ä¸ªæ–°çš„ APIï¼Œæ—¨åœ¨è®©èµ„æºè¯·æ±‚ï¼ˆé€šå¸¸æ˜¯ç½‘ç»œè¯·æ±‚ï¼‰ç®€å•å¾ˆå¤šã€‚æ–°çš„ Fetch API æ¯”æ—§çš„ XHR æ–¹å¼å¥½å¾ˆå¤šçš„ä¸€ä¸ªæ–¹é¢æ˜¯ Fetch åŸºäº promiseï¼

å¸Œæœ›ä½ å·²ç»æ„è¯†åˆ° Fetch æ˜¯æœªæ¥å‘å‡ºè¯·æ±‚çš„é€”å¾„ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹è¯¥ APIï¼





> ### âš ï¸ **Fetch åŸºäº Promise** âš ï¸

```
      >æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œæ–°çš„ Fetch API åœ¨åå°åˆ©ç”¨ Promiseã€‚å¦‚æœä½ çŸ¥é“ Promise çš„åŸç†ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è·³åˆ°ä¸‹ä¸ªéƒ¨åˆ†ã€‚å¦‚æœå¯¹"Promiseâ€ä¸€è¯æœ‰ç‚¹ç”Ÿç–ï¼Œå¯¹ä½ çš„æœªæ¥ç”Ÿæ´»ä¹Ÿä¸ç¡®å®šï¼Œé‚£ä¹ˆä¹Ÿä¸ç”¨æ‹…å¿ƒï¼æ”¾æ¾ï¼Œç„¶åè½¬åˆ°æˆ‘ä»¬çš„ JavaScript Promise ç®€çŸ­è¯¾ç¨‹å¹¶æé«˜ä½ çš„ JavaScript æŠ€èƒ½ã€‚
```





> ### âš ï¸ **å¯èƒ½éœ€è¦ Polyfill** âš ï¸

```
      > è¯·è®¿é—® http://caniuse.com/#feat=fetch ï¼Œçœ‹çœ‹ä½ çš„æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¿™ä¸€æ–° APIï¼

      > å¦‚æœä½ çš„æµè§ˆå™¨ä¸æ”¯æŒï¼Œåªéœ€å‘ä½ çš„é¡¹ç›®ä¸­æ·»åŠ [æ­¤ polyfill](https://github.com/github/fetch)ï¼Œè¿™æ ·å³ä½¿æµè§ˆå™¨ä¸æ”¯æŒï¼Œä¹Ÿå¯ä»¥å¼€å§‹ä½¿ç”¨ Fetchï¼
```

---

## 3.3 ç¼–å†™ Fetch è¯·æ±‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ fetch è¯·æ±‚ï¼Œç„¶åæˆ‘ä»¬å°†å‘å‡ºä¸€ä¸ª fetch è¯·æ±‚ä»¥ä» Unsplash è·å–å›¾ç‰‡ã€‚

```js
fetch('<URL-to-the-resource-that-is-being-requested>');
```

å°±æ˜¯è¿™æ ·ï¼Œå¯¹äºæœ€ç®€å•çš„å½¢å¼ï¼ŒFetch è¯·æ±‚å°±æ˜¯ `fetch()` å‡½æ•°å’Œè¦è¯·æ±‚çš„èµ„æºå¯¹åº”çš„ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å®ƒéå¸¸ç®€çŸ­ï¼Œæ˜“äºè¯»æ‡‚ï¼ˆæˆ‘è§‰å¾—æˆ‘å·²ç»å–œæ¬¢ä¸Šå®ƒäº†ï¼ï¼‰ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹çœŸæ­£çš„è¯·æ±‚çœ‹èµ·æ¥æ€æ ·ï¼š

```js
fetch('https://api.unsplash.com/search/photos?page=1&query=flowers');
```

å¦‚æœä½ å°è¯•åœ¨æ§åˆ¶å°ä¸Šè¿è¡Œæ­¤ Fetch è¯·æ±‚ï¼Œé‚£ä¹ˆåº”è¯¥ä¼šè¿”å›ä¸€ä¸ª Promiseã€‚

![img](assets/805aec1c-4f08-4be0-828f-391c603c5889)

*æ­£åœ¨ Unsplash ç½‘ç«™çš„æ§åˆ¶å°ä¸Šè¿è¡Œ fetch è¯·æ±‚ã€‚è¯¥ fetch è¯·æ±‚è¿”å›ä¸€ä¸ª Promiseã€‚*



> ### ğŸ’¡ **è·¨åŸŸè¯·æ±‚é—®é¢˜ï¼Ÿ** ğŸ’¡

> ä½ æ˜¯å¦è¿è¡Œäº† Fetch è¯·æ±‚å¹¶ä¸”ä¸å¯è¡Œï¼Ÿæ˜¯åœ¨ Unsplash ç½‘ç«™ä¸Šè¿è¡Œçš„å—ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œç¡®ä¿è½¬åˆ° <https://unsplash.com/>ï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œç„¶åå†å°è¯•è¿è¡Œè¯·æ±‚ã€‚

> è™½ç„¶ Fetch æ˜¯å¾ˆå¼ºå¤§çš„æ–° APIï¼Œå¹¶ä¸”å°†æ›¿ä»£ XHR å¯¹è±¡æ¥è¿›è¡Œå¼‚æ­¥ç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯ä¹Ÿå¿…é¡»éµå®ˆç½‘ç»œè¯·æ±‚è§„åˆ™ã€‚**Fetch è¯·æ±‚ä¾ç„¶éœ€è¦éµå®ˆå…³äºå…±äº«èµ„æºçš„è·¨åŸŸåè®®**ã€‚è¿™æ„å‘³ç€ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä½ åªèƒ½åœ¨å°†æœ€ç»ˆåŠ è½½æ•°æ®çš„åŒä¸€ç½‘åŸŸä¸­å‘å‡ºèµ„æºå’Œæ•°æ®è¯·æ±‚ã€‚





Unsplash éœ€è¦ Authorization æ ‡å¤´æ¥é€šè¿‡å…¶ API å‘å‡ºè¯·æ±‚ã€‚è¯·è®¿é—®ä»¥ä¸‹ Fetch æ–‡æ¡£è¿æ¥ï¼Œçœ‹çœ‹å¦‚ä½•å‘ Fetch è¯·æ±‚æ·»åŠ  `Authorization` æ ‡å¤´ã€‚

- <https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalFetch/fetch>
- <https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch>
- <https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API>



#### ä¹ é¢˜ 1/2

æ–‡æ¡£æ˜¯å¼€å‘è€…çš„æœ€å¥½æœ‹å‹ï¼è¯·èŠ±æ—¶é—´é˜…è¯»è¿™äº›æ–‡æ¡£ï¼Œå¹¶ä»ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©å‘ Fetch è¯·æ±‚æ·»åŠ æ ‡å¤´çš„æ­£ç¡®æ–¹å¼ã€‚æ­¤å¤–ï¼Œä¸è¦åªæ˜¯çŒœæµ‹ï¼Œè€Œæ˜¯å°è¯•åœ¨ä½ çš„åº”ç”¨æˆ–æ§åˆ¶å°ä¸­è¿è¡Œä½ è®¤ä¸ºæ­£ç¡®çš„ä»£ç ï¼Œçœ‹çœ‹è¿è¡Œæ•ˆæœå¦‚ä½•ï¼

- fetch.setRequestHeader('Authorization', 'Client-ID abc123'); 
  fetch(`https://api.unsplash.com/search/photos?page=1&query=${searchedForText}`);
- fetch(`https://api.unsplash.com/search/photos?page=1&query=${searchedForText}`, { 
  â€‹     headers: { 
  â€‹         Authorization: 'Client-ID abc123' 
  â€‹    } 
  });
- const requestHeaders = new Headers(); 
  requestHeaders.append('Authorization', 'Client-ID abc123'); 
  fetch(`https://api.unsplash.com/search/photos?page=1&query=${searchedForText}`, { 
  â€‹     headers: requestHeaders 
  });
- fetch(`https://api.unsplash.com/search/photos?page=1&query=${searchedForText}`).then(function(request){ 
  â€‹     request.addHeader('Authorization', 'Client-ID abc123'); 
  });



#### ä¹ é¢˜ 2/2

ä½ è®¤ä¸º Fetch è¯·æ±‚çš„é»˜è®¤ HTTP æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿä¸å¦¨å°è¯•è¿è¡Œä¸€ä¸ª Fetch è¯·æ±‚ï¼Œå¹¶åœ¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹æ‰€ä½¿ç”¨çš„ HTTP æ–¹æ³•ã€‚

è¯·å‚é˜…è§„èŒƒä¸­çš„ä»¥ä¸‹é“¾æ¥ä»¥äº†è§£è¯¦æƒ…ï¼š

- <https://fetch.spec.whatwg.org/#methods>
- <https://fetch.spec.whatwg.org/#requests>

- FETCH
- fetch
- POST
- post
- GET
- get
- REQUEST
- request



### æ›´æ”¹ HTTP æ–¹æ³•

Fetch è¯·æ±‚çš„é»˜è®¤ HTTP æ–¹æ³•æ˜¯ `GET` æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨é…ç½®å¯¹è±¡ä¸­ä¼ å…¥ `method` å±æ€§æ¥é€‰æ‹©ä¸åŒçš„ HTTP æ–¹æ³•ï¼š

```js
fetch(`https://api.unsplash.com/search/photos?page=1&query=${searchedForText}`, {
    method: 'POST'
});
```

è¿™æ ·å°†å‘é€å…·æœ‰ `POST` HTTP æ ‡å¤´çš„è¯·æ±‚ã€‚

Fetch çš„è§„èŒƒå¹¶æ²¡é™åˆ¶è¯¥ä½¿ç”¨ä»€ä¹ˆ HTTP æ–¹æ³•ï¼Œè™½ç„¶è¯¥è§„èŒƒå»ºè®®æ‰€æœ‰æ–¹æ³•éƒ½å¤§å†™ï¼Œä»¥ä¾¿ä¸ HTTP åŠ¨è¯è§„èŒƒä¿æŒä¸€è‡´ã€‚

---

## 3.4 å¤„ç†å“åº”

ä½ å·²ç»å­¦ä¹ äº†å¦‚ä½•å‘å‡º Fetch è¯·æ±‚ï¼Œå¹¶ä¸”å‘é€äº†å‡ ä¸ªè¯·æ±‚...ä½†æ˜¯ä»€ä¹ˆä¹Ÿæ²¡å‘ç”Ÿï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å‘Šè¯‰ä»£ç è¦å¤„ç†å“åº”ã€‚æˆ‘ä»¬è®©ä»£ç å‡†å¤‡å¥½å¤„ç†å“åº”å§ã€‚

æ³¨æ„ï¼ŒFetch åŸºäº Promiseã€‚è¿™æ„å‘³ç€ï¼Œå½“æˆ‘ä»¬å‘å‡º Fetch è¯·æ±‚æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨è¿”å›ä¸€ä¸ªå¯ä»¥ç”¨æ¥ç›‘å¬å“åº”çš„ promiseã€‚





> ### ğŸ’¡ **Javascript Promise æé†’** ğŸ’¡

> Fetch è¯·æ±‚è¿”å›çš„æ•°æ®å®Œå…¨é€šè¿‡ Promise è¿›è¡Œå¤„ç†ï¼Œå¦‚æœä½ å¯¹ä»»ä½•éƒ¨åˆ†ä¸æ˜ç™½ï¼Œæˆ–ä¸çŸ¥é“ `.then()` çš„å·¥ä½œåŸç†æˆ–ä¸ºä½•éœ€è¦å®ƒï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„ [JavaScript Promise](https://www.udacity.com/course/javascript-promises--ud898) è¯¾ç¨‹ã€‚





å› ä¸º Fetch è¯·æ±‚ä¼šè¿”å›ä¸€ä¸ª Promiseï¼Œæ‰€ä»¥ä½ åªéœ€å¯¹è¯¥ Promise è°ƒç”¨ `.then()`ã€‚

```js
fetch(`https://api.unsplash.com/search/photos?page=1&query=${searchedForText}`, {
    headers: {
        Authorization: 'Client-ID abc123'
    }
}).then(function(response) {
    debugger; // ä½¿ç”¨è¿”å›çš„response
});
```

è¯·å°†ä¸Šè¿°ä»£ç æ”¾å…¥æˆ‘ä»¬çš„ JavaScript æ–‡ä»¶ä¸­å¹¶æœç´¢æŸä¸ªå†…å®¹ã€‚å› ä¸ºæˆ‘ä»¬åœ¨ `.then()` å‡½æ•°ä¸­æ·»åŠ äº† `debugger` è¡Œï¼Œå› æ­¤å½“æœ€åè¿”å›å“åº”æ—¶ï¼Œä»£ç å°†åœ¨ `debugger` è¡Œæš‚åœã€‚





![img](assets/fcc220ce-8bfc-4cbf-8e15-42fff227fb50)

*æµè§ˆå™¨æ˜¾ç¤ºåŠ è½½äº†å¼€å‘è€…å·¥å…·çš„åº”ç”¨ã€‚æœç´¢äº†"treesâ€ã€‚ä»£ç åœ¨ debugger è¡Œæš‚åœäº†ã€‚å“åº”æ˜¯ Response å¯¹è±¡ã€‚*





#### ç»ƒä¹ é¢˜

æˆ‘ä»¬æˆåŠŸåœ°å‘å‡ºäº†è¯·æ±‚ï¼Œä½ åº”è¯¥èƒ½å¤Ÿåœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°å“åº”ã€‚å“ªä¸ªå±æ€§å…·æœ‰å®é™…çš„ JSON å›¾ç‰‡æ•°æ®ï¼Ÿ

- `.data`
- `.images`
- `.response`
- `.images` å’Œ `.data`
- éƒ½ä¸å¯¹

---

## 3.5 Response å¯¹è±¡

çœ‹åˆ°è¿”å›çš„å“åº”æ˜¯ `Response` ç±»å‹äº†å—ï¼Ÿè¿™ç§ `Response` å¯¹è±¡æ˜¯ Fetch API çš„æ–°åŠŸèƒ½ï¼Œå½“ Fetch è¯·æ±‚ resolve æ—¶å°±ä¼šè¿”å›è¯¥å¯¹è±¡ã€‚

è¿™å¾ˆæ£’ï¼Œä½†æ˜¯ä½ æ³¨æ„åˆ° Response å¯¹è±¡æœ‰ä»€ä¹ˆå¥‡æ€ªçš„åœ°æ–¹å—ï¼Ÿå®ƒæ²¡æœ‰æˆ‘ä»¬æœç´¢çš„ä»»ä½•æ•°æ®ï¼è¿™æ˜¯å› ä¸º Response å¯¹è±¡å…·æœ‰å…³äºå“åº”æœ¬èº«çš„ä¿¡æ¯ï¼Œä½†æ˜¯å°šæ— æ•°æ®...è¦å®é™…åœ°è·å–æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è·å–å“åº”çš„â€œä¸»ä½“â€ã€‚

å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„ Unsplash API å°†è¿”å› JSONï¼Œæˆ‘ä»¬éœ€è¦å¯¹ response å˜é‡è°ƒç”¨ `.json()`ã€‚

```js
fetch(`https://api.unsplash.com/search/photos?page=1&query=${searchedForText}`, {
    headers: {
        Authorization: 'Client-ID abc123'
    }
}).then(function(response) {
    return response.json();
});
```

Response å¯¹è±¡ä¸Šçš„ `.json()` æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é“¾æ¥å¦ä¸€ä¸ª `.then()` ä»¥å®é™…åœ°è·å–å¹¶å¼€å§‹ä½¿ç”¨è¿”å›çš„æ•°æ®ã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬è°ƒç”¨ `addImage` ä»¥å‘å…¶ä¼ é€’è¿”å›çš„æ•°æ®ï¼š

```js
fetch(`https://api.unsplash.com/search/photos?page=1&query=${searchedForText}`, {
    headers: {
        Authorization: 'Client-ID abc123'
    }
}).then(function(response) {
    return response.json();
}).then(addImage);

function addImage(data) {
    debugger;
}
```





Response å¯¹è±¡ä¸Šæœ‰å¤šä¸ªæ–¹æ³•ã€‚æ¯ä¸ªæ–¹æ³•éƒ½ä½¿ä»£ç èƒ½å¤„ç†ä¸åŒç±»å‹çš„å“åº”ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ `.json()` æ–¹æ³•å°†ä½¿å“åº”è½¬æ¢ä¸º JSONã€‚å¦‚æœæˆ‘ä»¬è¯·æ±‚çš„æ˜¯å›¾ç‰‡ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ





### ç»ƒä¹ é¢˜

å¦‚æœä½ æƒ³è·å–å›¾ç‰‡ï¼Œåº”è¯¥ä½¿ç”¨ä¸‹é¢çš„å“ªä¸ªæ–¹æ³•ï¼Ÿå¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·è®¿é—®ä»¥ä¸‹é“¾æ¥ï¼š

- [å‘å‡º fetch è¯·æ±‚](https://developer.mozilla.org/zh-cn/docs/Web/API/Fetch_API/Using_Fetch#Making_fetch_requests)
- <https://davidwalsh.name/fetch>

- `.arrayBuffer()`
- `.blob()`
- `.formData()`
- `.json()`
- `.text()`



---

## 3.6 ES6 ç®­å¤´å‡½æ•°

ä½ å¯èƒ½ä¼šè§‰å¾—è¿™ä¸ª Fetch è¯·æ±‚ä¼¼ä¹æœ‰å¤ªå¤šçš„ä»£ç ...çš„ç¡®æ˜¯è¿™æ ·ã€‚å‡å°‘ä»£ç çš„ä¸€ç§ç®€ä¾¿æ–¹å¼æ˜¯ä½¿ç”¨ ES6 ç®­å¤´å‡½æ•°ï¼æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°å°†ç¬¬ä¸€ä¸ªè·å¾—å“åº”çš„ `.then()` å‡½æ•°ã€å¯¹å…¶è°ƒç”¨ `.json()` æ–¹æ³•å¹¶è¿”å› Promise å…¨å˜æˆä¸€è¡Œï¼š

```js
// ä¸ä½¿ç”¨ç®­å¤´å‡½æ•°
}).then(function(response) {
    return response.json();
})

// ä½¿ç”¨ç®­å¤´å‡½æ•°
}).then(response => response.json())
```

æ–°çš„è¯·æ±‚å°†å˜æˆï¼š

```js
fetch(`https://api.unsplash.com/search/photos?page=1&query=${searchedForText}`, {
    headers: {
        Authorization: 'Client-ID abc123'
    }
}).then(response => response.json())
.then(addImage);

function addImage(data) {
    debugger;
}
```

å¦‚æœä½ ä¸ç†Ÿæ‚‰ç®­å¤´å‡½æ•°ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„ [ES6 è¯¾ç¨‹](https://classroom.udacity.com/courses/ud356)ï¼





![img](assets/ec47abe8-3a0c-45de-b486-a993bff49b60)

*æµè§ˆå™¨æ˜¾ç¤ºè¯¥åº”ç”¨åŠ è½½äº†å¼€å‘è€…å·¥å…·ã€‚æœç´¢äº†"treesâ€ã€‚æµè§ˆå™¨åœ¨è°ƒè¯•è¡Œæš‚åœã€‚å®é™…çš„ JSON å“åº”å‡ºç°åœ¨æ§åˆ¶å°ä¸Šã€‚*

---

## 3.7 æ˜¾ç¤ºå†…å®¹å¹¶å¤„ç†é”™è¯¯

æˆ‘ä»¬å‘ Unsplash å‘å‡ºäº†è¯·æ±‚ï¼Œå®ƒè¿”å›äº†å“åº”ï¼Œç„¶åæˆ‘ä»¬å°†è¯¥å“åº”è½¬æ¢ä¸º JSONï¼Œç°åœ¨æˆ‘ä»¬çœ‹åˆ°äº†å®é™…çš„ JSON æ•°æ®ã€‚å¤ªæ£’äº†ï¼ç°åœ¨æˆ‘ä»¬åªéœ€åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºè¯¥å›¾ç‰‡å’Œæ–‡å­—è¯´æ˜ã€‚

æˆ‘ä½¿ç”¨äº†ä»¥ä¸‹ä»£ç ï¼š

```js
function addImage(data) {
    let htmlContent = '';
    const firstImage = data.results[0];

    if (firstImage) {
        htmlContent = `<figure>
            <img src="${firstImage.urls.small}" alt="${searchedForText}">
            <figcaption>${searchedForText} by ${firstImage.user.name}</figcaption>
        </figure>`;
    } else {
        htmlContent = 'Unfortunately, no image was returned for your search.'
    }

    responseContainer.insertAdjacentHTML('afterbegin', htmlContent);
}
```

ä¸Šè¿°ä»£ç å°†ï¼š

- è·å–ä» Unsplash è¿”å›çš„ç¬¬ä¸€ä¸ªå›¾ç‰‡
- ä½¿ç”¨å°å›¾ç‰‡åˆ›å»ºä¸€ä¸ª `<figure>` æ ‡è®°
- åˆ›å»ºä¸€ä¸ª `<figcaption>` ä»¥æ˜¾ç¤ºæœç´¢çš„æ–‡æœ¬å’Œç…§ç‰‡æ‹æ‘„è€…çš„åå­—
- å¦‚æœæ²¡æœ‰è¿”å›å›¾ç‰‡ï¼Œåˆ™å‘ç”¨æˆ·æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯





## å¤„ç†é”™è¯¯

æˆ‘ä»¬çš„åº”ç”¨å·²ç»å‡ ä¹è¦å®Œæˆä» Unsplash è·å–å›¾ç‰‡çš„æµç¨‹äº†ï¼æˆ‘ä»¬è¯·æ±‚äº†å›¾ç‰‡å¹¶å°†å…¶æ·»åŠ åˆ°ç½‘é¡µä¸­ï¼Œä½†è¿™åªæ˜¯ä¸€ç§å¯èƒ½çš„ç»“æœã€‚å½“ç„¶ï¼Œåº”ç”¨å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°è¿™ç§ç»“æœï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å¤„ç†ä»»ä½•é”™è¯¯ã€‚å¯èƒ½ä¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„é”™è¯¯å‘¢ï¼Ÿæˆ‘èƒ½æƒ³åˆ°çš„åŒ…æ‹¬ï¼š

- ç½‘ç»œå­˜åœ¨é—®é¢˜
- fetch è¯·æ±‚å­˜åœ¨é—®é¢˜
- Unsplash æ²¡æœ‰å…³äºæœç´¢å­—è¯çš„å›¾ç‰‡

æˆ‘ä»¬åœ¨ `addImage` å‡½æ•°ä¸­å¤„ç†æœ€åä¸€ä¸ªé”™è¯¯ã€‚å¯¹äºå¦å¤–ä¸¤ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ Fetch è¯·æ±‚é“¾æ¥ `.catch()` æ–¹æ³•ï¼

å› ä¸º Fetch è¯·æ±‚ä¼šè¿”å›ä¸€ä¸ª Promiseï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Promise API çš„ `.catch()`ã€‚

æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª `.catch()` æ–¹æ³•ä»¥å¤„ç†é”™è¯¯ï¼š

```js
fetch(`https://api.unsplash.com/search/photos?page=1&query=${searchedForText}`, {
    headers: {
        Authorization: 'Client-ID abc123'
    }
}).then(response => response.json())
.then(addImage)
.catch(e => requestError(e, 'image'));

function addImage(data) {
    debugger;
}

function requestError(e, part) {
    console.log(e);
    responseContainer.insertAdjacentHTML('beforeend', `<p class="network-warning">Oh no! There was an error making a request for the ${part}.</p>`);
}
```

ä¸Šè¿°ä»£ç æ·»åŠ äº† `requestError` å‡½æ•°å¹¶å‘ Promise é“¾çš„æœ€åæ·»åŠ äº† `.catch()` è¯·æ±‚ã€‚`.catch()` å‡½æ•°å°†æ¥æ”¶ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼ˆæˆ‘ä»¬å°†å…¶å­˜å‚¨åœ¨ `e` å˜é‡ä¸­ï¼‰å¹¶åè¿‡æ¥è°ƒç”¨ `requestError`ï¼Œä¼ å…¥é”™è¯¯å¯¹è±¡å’Œå¤±è´¥çš„è¯·æ±‚ã€‚å¦‚æœ Promise åœ¨ä»»ä½•åœ°æ–¹æ‹’ç»äº†ï¼Œåˆ™ `requestError` å‡½æ•°å°†è¾“å‡ºé”™è¯¯æ—¥å¿—å¹¶å‘ç”¨æˆ·æ˜¾ç¤ºä¸€æ¡è­¦å‘Šæ¶ˆæ¯ï¼ŒæŒ‡å‡ºè¯·æ±‚å› æŸç§åŸå› å¤±è´¥äº†ã€‚

---

## 3.8 é¡¹ç›®æ€»ç»“

### æ·»åŠ çº½çº¦æ—¶æŠ¥ä»£ç 

##### ç°åœ¨çœ‹ä½ èƒ½å¦æŒ‰ç…§è¿™äº›æ­¥éª¤æ“ä½œï¼Œå¹¶æ˜¾ç¤ºçº½çº¦æ—¶æŠ¥æ–‡ç« ã€‚å½“ä½ èƒ½å¤Ÿåœ¨åº”ç”¨ä¸­è¿›è¡Œæœç´¢å¹¶æ˜¾ç¤ºå›¾ç‰‡å’Œä¸€äº›ã€Šçº½çº¦æ—¶æŠ¥ã€‹æ–‡ç« æ—¶ï¼Œé€‰ä¸­ä¸‹é¢çš„å¤é€‰æ¡†ã€‚æˆ‘ä»¬ä»‹ç»çš„å†…å®¹å¯èƒ½æœ‰ç‚¹å¤šï¼Œæˆ‘ä»¬è¯¦ç»†è®²è§£äº†å¦‚ä½•å‘å‡º Fetch è¯·æ±‚ä»¥åŠå¦‚ä½•å¤„ç†å“åº”ã€‚å¯¹äºæ­¤è¯·æ±‚ï¼Œä½ åŸºæœ¬ä¸Šéœ€è¦éµå®ˆç›¸åŒçš„æ­¥éª¤ã€‚ä½ å°†éœ€è¦ï¼š å‘ NYTimes API å‘å‡ºè¯·æ±‚ï¼› å°†å“åº”è½¬æ¢ä¸º JSONï¼› å¾ªç¯è®¿é—® JSON æ•°æ®å¹¶å°†æ–‡ç« æ·»åŠ åˆ°ç½‘é¡µä¸Šã€‚å¦‚æœä½ ä½¿ç”¨ `.catch()` å¤„ç†ä»»ä½•ç½‘ç»œé”™è¯¯ï¼Œé‚£ä¹ˆå¯ä»¥åŠ åˆ†ï¼

Task List

- æˆ‘å·²æ·»åŠ çº½çº¦æ—¶æŠ¥ä»£ç ï¼Œå¹¶ä¸”æ–‡ç« æ·»åŠ åˆ°ç½‘é¡µä¸Šäº†ï¼





<video class="video__el" crossorigin="anonymous" style="box-sizing: inherit; width: 770px;"></video>

00:00 / 01:05



1x

CC

z




  






  






  




  