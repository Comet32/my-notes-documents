

# 使用 React 的开发流程

[TOC]

## 我的想法

- 1.根据 UI 的设计稿划分组件，对于需要重复调用的组件划分为展示型组件，其行为和数据的来源由容器型组提供。
  - 需要注意使用 redux 进行开发可能行为和数据来源于 redux ，但也可以让 redux 所提供的数据和行为传递给一些容器型组件再传递给展示型组件。
  - 也可以在此阶段确定路由状态，并创建对应路由所要渲染的页面组件，很多时候可能页面组件会充当作为展示型组件的角色。
- 2.确定展示型组件所需要的数据和行为，并暴露一些接口用于接收这些数据和行为，编写展示型组件。
  - 在开发的过程中可以使用一些虚拟数据先进行替代。
  - 编写完展示型组件后可以编写测试（如果有测试环节的话）
- 3.与后端确定接口，并使用像`json-server`这样的库帮助我们构建一个模拟 server 以方便开发
  - 这一步可能会在开发开始之前，并且测试服务器后端也有可能会提供。
  - 在了解到接口数据之后，就需要思考 redux 的数据情况了，是一个页面一个 reducer，还是将某些数据拆分出来「范式化」，而一些管理 UI 和行为的数据则单独存放在页面 reducer 之中。
- 4.编写容器型组件，主要任务可能是组合展示型组件，并编写行为和获取数据，最终传入展示型组件之中。
  - 可能涉及到编写测试
- 5.编写路由。
- 6.与后端连调接口。
- 7.构建&部署

> 这只是我目前所能想到的一些关于构建一个 React 应用的流程，其中肯定会存在一些差异和细节问题，这需要在之后不断的进行 review 来将构建描述的更仔细和清楚。



## 官方想法

> 本部分内容来自——[React 哲学](https://zh-hans.reactjs.org/docs/thinking-in-react.html)
>
> 这部分内容也是整个课程的基础，整个课程也是按照官方的指导思想进行的。

假设我们已经有了一个返回 JSON 的 API，以及设计师提供的组件设计稿。

### 第一步：将设计好的 UI 划分为组件层级

- 需要在设计稿上用方框圈出每一个组件（包括它们的子组件），并且以合适的名称命名。

- 单一功能原则：一个组件原则上只能负责一个功能。如果它需要负责更多的功能，这时候就应该考虑将它拆分成更小的组件。

- 在实践中，因为你经常是在向用户展示 JSON 数据模型，所以**如果你的模型设计得恰当**，UI（或者说组件结构）便会与数据模型一一对应，这是因为 UI 和数据模型都会倾向于遵守相同的*信息结构*。因此，将用户界面划分为组件的工作量就可以忽略不计了。只需使组件完全对应地展现数据模型的某部分即可。

  > 我们应该始终注意数据模型与 UI 的联系，可能 API 的数据结构并没有那么恰当与完美，但我们可以将其进行适当的转换、更改使其与 UI（或者说组件结构）一一对应。

- 把框选出来的组件描述为更加清晰的层级。比如这样：

  - `FilterableProductTable`
    - `SearchBar`
    - `ProductTable`
      - `ProductCategoryRow`
      - `ProductRow`

### 第二步：用 React 创建一个静态版本

- 先用已有的数据模型渲染一个不包含交互功能的 UI。最好将渲染 UI 和添加交互这两个过程分开。这是因为，编写一个应用的静态版本时，往往要编写大量代码，而不需要考虑太多交互细节；添加交互功能时则要考虑大量细节，而不需要编写太多代码。所以，将这两个过程分开进行更为合适。我们会在接下来的代码中体会到其中的区别。

- 在构建应用的静态版本时，我们需要创建一些会重用其他组件的组件，然后通过 *props* 传入所需的数据。*props* 是父组件向子组件传递数据的方式。即使你已经熟悉了 *state* 的概念，也**完全不应该使用 state** 构建静态版本。state 代表了随时间会产生变化的数据，应当仅在实现交互时使用。所以构建应用的静态版本时，你不会用到它。

  > 也不一定完全不使用 state，对于组件的一些动画交互效果我们也可以使用 state 来进行管理。

- 你可以自上而下或者自下而上构建应用：自上而下意味着首先编写层级较高的组件，自下而上意味着从最基本的组件开始编写。当你的应用比较简单时，使用自上而下的方式更方便；对于较为大型的项目来说，自下而上地构建，并同时为低层组件**编写测试**是更加简单的方式。

### 第三步：确定 UI state 的最小（且完整）表示

- 想要使你的 UI 具备交互功能，需要有触发基础数据模型改变的能力。React 通过 **state** 来完成这个任务。
- 为了正确地构建应用，你首先需要找出应用所需的 state 的最小表示，并根据需要计算出其他所有数据。其中的关键正是 [DRY: *Don’t Repeat Yourself*](https://en.wikipedia.org/wiki/Don't_repeat_yourself)。只保留应用所需的可变 state 的最小集合，**其他数据均由它们计算产生**。比如，你要编写一个任务清单应用，你只需要保存一个包含所有事项的数组，而无需额外保存一个单独的 state 变量（用于存储任务个数）。当你需要展示任务个数时，只需要利用该数组的 length 属性即可。
- 通过问自己以下三个问题，你可以逐个检查相应数据是否属于 state：
  1. 该数据是否是由父组件通过 props 传递而来的？如果是，那它应该不是 state。
  2. 该数据是否随时间的推移而保持不变？如果是，那它应该也不是 state。
  3. 你能否根据其他 state 或 props 计算出该数据的值？如果是，那它也不是 state。

### 第四步：确定 state 放置的位置

- 哪个组件应该拥有某个 state 这件事，**对初学者来说往往是最难理解的部分**。尽管这可能在一开始不是那么清晰，但你可以尝试通过以下步骤来判断，对于应用中的每一个 state：
  - 找到根据这个 state 进行渲染的所有组件。
    - 找到他们的共同所有者（common owner）组件（在组件层级上高于所有需要该 state 的组件）。
  - 该共同所有者组件或者比它层级更高的组件应该拥有该 state。
  - 如果你找不到一个合适的位置来存放该 state，就可以直接创建一个新的组件来存放该 state，并将这一新组件置于高于共同所有者组件层级的位置。

### 第五步：添加反向数据流

- React 通过一种比传统的双向绑定略微繁琐的方法来实现反向数据传递。尽管如此，但这种需要显式声明的方法更利于人们理解程序的运作方式。

> 也就是通过向展示型组件传入回调，利用触发回调更改容器型组件来更改 state 从而更改 UI 状态

### 这就是全部了

希望这篇文档能够帮助你建立起构建 React 组件和应用的一般概念。尽管你可能需要编写更多的代码，但是别忘了：**比起写，代码更多地是给人看的**。我们一起构建的这个模块化示例应用的代码就很适合阅读。当你开始构建更大的组件库时，你会意识到这种代码**模块化和清晰度的重要性**。并且随着代码重用程度的加深，你的代码行数也会显著地减少。:)	