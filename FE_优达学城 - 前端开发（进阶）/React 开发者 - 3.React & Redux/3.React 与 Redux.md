# 3. React ä¸ Redux

> ç»“åˆä½¿ç”¨ Redux å’Œ React æ¥æ‰©å±•åº”ç”¨çš„åŠŸèƒ½ã€‚å¹¶å­¦ä¹  react-redux ç»‘å®šï¼Œä»¥åŠå…¶ä»–åŠŸèƒ½æ€§ JavaScript æŠ€å·§ã€‚

[TOC]

---

## 3.1 ç®€ä»‹

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨äº†çº¯ Reduxã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç›´åˆ°ç°åœ¨ä¸€åˆ‡éƒ½æ²¡æœ‰æ¶‰åŠæ¡†æ¶æˆ–è§†å›¾åº“ã€‚

æ¦‚æ‹¬æ¥è¯´ï¼Œæ­¤å‰æˆ‘ä»¬ä½¿ç”¨ `createStore()` å‘å…¶ä¼ é€’äº† reducer å‡½æ•°ï¼Œåˆ›å»ºäº† storeã€‚ç„¶åæˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨ `dispatch()`ã€`getState()` å’Œ `subscribe()` å°† Redux å…³è”åˆ° React åº”ç”¨ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼šæ•ˆæœå¹¶ä¸ç†æƒ³ã€‚æˆ‘ä»¬æœ€ç»ˆå°† store å‘ä¸‹ä¼ é€’åˆ°ä¸»ç»„ä»¶ï¼Œä»¥ä¾¿è®¿é—® `dispatch()`ã€`getState()`å’Œ `subscribe()`ã€‚è¿™ç§æ–¹æ³•å¯¹å°å‹åº”ç”¨æ¥è¯´æ˜¯å¯è¡Œçš„ï¼Œä½†æ— æ³•æ‰©å±•åˆ°æ›´å¤§è§„æ¨¡çš„æ›´å¤šç»„ä»¶ã€‚

è¿™å¹¶ä¸è¡¨æ˜ Redux ä¸é«˜æ•ˆï¼›åªæ˜¯æ²¡æœ‰æ­£ç¡®çš„æŠ½è±¡ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å­¦ä¹ çš„éƒ½æ˜¯ä½çº§åˆ«çš„ Redux æ–¹æ³•ï¼Œå¹¶å°è¯•åœ¨ React ä¸­ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚å¦‚æœæœ‰æ›´å¥½çš„æŠ½è±¡å‘¢ï¼Œä¸“é—¨ç”¨äºç»“åˆä½¿ç”¨ Redux å’Œ Reactï¼Ÿå¥½æ¶ˆæ¯æ˜¯ï¼Œç¡®å®æœ‰è¿™æ ·çš„æŠ½è±¡ï¼Œå®ƒè¢«ç§°ä¸º `react-redux`ï¼Œç”± Redux æœ¬èº«çš„å‘æ˜è€…åˆ›å»ºè€Œæˆã€‚

`react-redux` çš„æœ€å¤§ä¼˜åŠ¿æ˜¯å¯ä»¥ä» React ç»„ä»¶å†…æ´¾é£ action å’Œè®¿é—® Redux storeã€‚å€ŸåŠ© `react-redux` çš„`Provider` ç»„ä»¶å’Œ `connect()` æ–¹æ³•ï¼Œæ‰€æœ‰è¿™ä¸€åˆ‡æˆä¸ºå¯èƒ½ã€‚

`connect()` ä½¿ä½ èƒ½å¤ŸæŒ‡å®šå“ªä¸ªç»„ä»¶åº”è¯¥ä» store ä¸­æ¥æ”¶å“ªäº›æ•°æ®ï¼Œå¹¶ä¸” `Provider` ä½¿ `connect()` èƒ½æ­£å¸¸å·¥ä½œã€‚æˆ‘ä»¬æ·±å…¥äº†è§£ä¸‹è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚



---

## 3.2 Provider

è¿˜è®°å¾—ä¹‹å‰çš„è¿™ä¸ªåµŒå¥—ç»„ä»¶ç»“æ„å—ï¼Ÿï¼š

![1532636193090](assets/1532636193090.png)

æœ€åº•å±‚çš„ç»„ä»¶éœ€è¦è®¿é—® storeï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åªä½¿ç”¨ Reactï¼ŒåµŒå¥—ç»„ä»¶ä¸­çš„çˆ¶ç»„ä»¶éœ€è¦æ¥æ”¶ store å±æ€§æ¥å°†å®ƒä¼ é€’ç»™å­ç»„ä»¶ï¼Œè¿™å«åš prop çº¿ç¨‹ï¼ˆthreadingï¼‰ï¼š

![1532636268667](assets/1532636268667.png)

è¿™ä¸ä»…éå¸¸ç´¯äººï¼Œè€Œä¸”è¿˜å®¹æ˜“å¼•å…¥ä¸€äº›é”™è¯¯ã€‚

å¥½åœ¨ react-redux åŒ…å«ä¸€ä¸ªå«åš Provider çš„ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæœ‰æ•ˆåœ°å°† store æ·±å…¥ä¼ é€’åˆ°æœ€åº•å±‚çš„ç»„ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹æ— éœ€ä»»ä½• prop çº¿ç¨‹ã€‚

Provider å°†æ•´ä¸ªåº”ç”¨åŒ…è£¹èµ·æ¥ï¼Œè¿™æ ·æ‰€æœ‰éœ€è¦æ•°æ®çš„å­ç»„ä»¶éƒ½è¦å¯ä»¥ç›´æ¥ä» store æ¥æ”¶æ•°æ®ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®é™…æ“ä½œã€‚

---

### è®¾ç½®

åœ¨ä½¿ç”¨ **Provider** ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å®ƒï¼š

```npm
npm install --save react-redux
```

> --save å¯ä»¥å°† react-redux è¿™ä¸ªå†™å…¥ package.json æ–‡ä»¶ä¸­ï¼Œè¿™æ ·å½“æˆ‘ä»¬é‡æ–°è¿è¡Œæ—¶ï¼Œä¼šè‡ªå·±å®‰è£…è¿™äº›åŒ…ã€‚ï¼ˆåº”è¯¥æ˜¯è¿™æ ·ã€‚ã€‚ä¸è¿‡ç°åœ¨å·²ç»ä¸éœ€è¦äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹å°±ä¼šæœ‰ --saveï¼‰

å¯¹äºé€šè¿‡ ReactDOM æ¸²æŸ“åˆ° DOM çš„ç»„ä»¶ï¼Œç¡®ä¿å¯¼å…¥ **Provider**ã€‚æ³¨æ„ï¼šè¯¥ç»„ä»¶çš„æ–‡ä»¶åç§°å¾ˆçµæ´»ï¼Œä½†æ˜¯ä½ å¯èƒ½ç»å¸¸çœ‹åˆ°å‘½åä¸º `app.js`ã€`root.js` æˆ– `index.js`ï¼ˆå¦‚ä¸‹é¢çš„è§†é¢‘ä¸­ï¼‰ã€‚

```react
import { Provider } from 'react-redux';
```

### ä½¿ç”¨ Provider ç»„ä»¶

æˆ‘ä»¬åˆ é™¤æ‰è¿™äº› vanilla Redux çš„å¤æ‚éƒ¨åˆ†ï¼Œå›åˆ°æœ€åˆçš„ Hello World ç»„ä»¶ã€‚ï¼ˆå°† App.js è¿˜åŸï¼‰

ç°åœ¨ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯å®‰è£… react-reduxï¼Œè¿™å°†ä½¿ react ç»„ä»¶è¿æ¥ redux store å˜å¾—éå¸¸å®¹æ˜“ã€‚å®Œæˆå®‰è£…åï¼Œè®°å¾—é‡å¯å¼€å‘æœåŠ¡å™¨ã€‚

ç°åœ¨ä½ ä¼šæ³¨æ„åˆ°ï¼Œåƒæˆ‘ä¹‹å‰æåˆ°çš„ï¼Œæˆ‘ä»¬è¦å°† sotre ä¼ ç»™ App ç»„ä»¶ï¼Œä½†è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œå¦‚æœ APP ç»„ä»¶æœ‰å¾ˆå¤šå­ç»„ä»¶ï¼Œä¸”æ¯ä¸ªéƒ½éœ€è¦ store æ€ä¹ˆåŠï¼Ÿæ— è®ºå®ƒä»¬æ˜¯éœ€è¦åˆ†æ´¾ä»»ä½•ä¸œè¥¿è¿˜æ˜¯éœ€è¦è®¿é—® redux storeï¼Œé—®é¢˜æ˜¯ï¼Œæ¯å½“è¿™äº›å­ç»„ä»¶éœ€è¦ä¸ redux store äº¤äº’æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å°† store å‘ä¸‹ä¼ é€’ç»™æ‰€æœ‰è¿™äº›å­ç»„ä»¶ï¼Œè¿™ä¼šéå¸¸ä½æ•ˆï¼Œè€Œä¸”å¯¹äºå¼€å‘äººå‘˜æ¥è¯´ä¹Ÿå¾ˆæ— è¶£ã€‚

æˆ‘ä»¬å¯ä»¥åšçš„æ˜¯ï¼Œä½¿ç”¨è¿™ä¸ªå«åš Provider çš„ç»„ä»¶ï¼Œå®ƒæ¥è‡ªäº react-redux åº“ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸»è¦æ ¹ç»„ä»¶åŒ…å«åœ¨ provider å†…ï¼Œç„¶åä¸å°† store ä¼ é€’ç»™ App ç»„ä»¶ï¼Œæˆ‘ä»¬æƒ³åšçš„æ˜¯å°†å®ƒä¼ é€’ç»™ Provider ç»„ä»¶ï¼Œé‚£ä¹ˆåœ¨å°†æ¥ï¼Œæ¯å½“åº”ç”¨æ¸²æŸ“çš„ä»»ä½•ç»„ä»¶æˆ–åº”ç”¨æœ¬èº«éœ€è¦è®¿é—® redux store æˆ–åˆ†æ´¾ action æ—¶ï¼Œæ•´ä¸ªæ“ä½œéƒ½ä¼šæ›´åŠ ç®€ä¾¿ï¼š

![1532637060942](assets/1532637060942.png)

![1532636989633](assets/1532636989633.png)

[è¿™æ˜¯æœ¬è§†é¢‘ä¸­æ‰€åšæ›´æ”¹çš„ commitã€‚](https://github.com/udacity/reactnd-udacimeals-complete/commit/b8d39c14c22f7b9067a807a3a76ae133923b1669)

---

ä»»åŠ¡è¿›åº¦æ£€æŸ¥

Task List

- æˆ‘å·²ç»ä» `App` ç»„ä»¶ä¸­åˆ é™¤äº†ä¸€äº›è¾ƒä½ç­‰çº§çš„æ–¹æ³•
- æˆ‘å·²å°† `react-redux` ä¸­çš„ `Provider` ç»„ä»¶å¯¼å…¥åˆ° `index.js` ä¸­
- æˆ‘å·²ç»å°† `store`å±æ€§ ä¼ é€’åˆ° `Provider`
- æˆ‘ç”¨ `Provider` å°è£…äº† `App`

### ä½¿ç”¨ Provider

Provider çš„å¥¥ç§˜åœ¨äº React çš„ [context](https://facebook.github.io/react/docs/context.html)|([ç¿»è¯‘](https://doc.react-china.org/docs/context.html)) åŠŸèƒ½ã€‚ä»¥ä¸‹å†…å®¹æ‘˜è‡ª React æ–‡æ¡£ï¼š

> â€œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå½“ä½ åœ¨ç»„ä»¶æ ‘ä¸­ä¼ é€’æ•°æ®æ—¶ï¼Œä½ å¸Œæœ›ä¸ç”¨æ‰‹åŠ¨åœ°ç»è¿‡æ¯ä¸ªçº§åˆ«å‘ä¸‹ä¼ é€’å±æ€§ã€‚ä½ å¯ä»¥åœ¨ React ä¸­ä½¿ç”¨å¼ºå¤§çš„ 'context' API ç›´æ¥è¿™ä¹ˆåš"

Provider ä½¿ `connect()` æˆä¸ºå¯èƒ½çš„åŸå› æ˜¯ï¼Œæ­£å¦‚è¯¥æ–‡æ¡£æ‰€æè¿°çš„ï¼ŒProvider ä½¿æˆ‘ä»¬èƒ½å¤Ÿâ€œåœ¨ç»„ä»¶æ ‘ä¸­ä¼ é€’æ•°æ®æ—¶ï¼Œä¸éœ€è¦æ‰‹åŠ¨åœ°ç»è¿‡æ¯ä¸ªçº§åˆ«å‘ä¸‹ä¼ é€’æ•°æ®â€ã€‚

#### ç»ƒä¹ é¢˜

å…³äº **Provider** çš„æè¿°ï¼Œå“ªäº›æ­£ç¡®ï¼Ÿè¯·é€‰ä¸­æ‰€æœ‰é€‚ç”¨é¡¹ï¼š

- å®ƒå‘ store æä¾› API ç«¯ç‚¹ 
- å®ƒå°† store å…¨å±€åœ°æä¾›ç»™æ‰€æœ‰å­ç»„ä»¶ :star:
  - Provider åªæ˜¯ä¸€ä¸ª React ç»„ä»¶ï¼Œç”¨æ¥å°è£…æ•´ä¸ªåº”ç”¨ã€‚å®ƒæ¥å—Â `store`Â ä½œä¸ºå±æ€§ï¼Œç„¶åè®¾ç½®Â `store`Â `context`ï¼Œå°†å…¶å‘ä¸‹ä¼ é€’ç»™å…¶æ‰€æœ‰å­ç»„ä»¶ã€‚Provider å°è£…çš„æ‰€æœ‰ç»„ä»¶å°†æ¥æ”¶è¯¥`store`Â `context`ã€‚ 
- å®ƒå‘ store æä¾› action creator
- Provider åªæ˜¯ä¸€ä¸ªåŒ…è£¹åº”ç”¨çš„ React ç»„ä»¶ :star:
- æ²¡æœ‰ Provider çš„è¯ï¼Œä»»ä½• React-Redux åº”ç”¨éƒ½æ— æ³•æ­£å¸¸å·¥ä½œ



### Provider æ€»ç»“

Provider ä½¿ Redux èƒ½å¤Ÿå°†æ•°æ®ä» store ä¼ é€’ç»™éœ€è¦è¯¥æ•°æ®çš„ä»»ä½• React ç»„ä»¶ã€‚å®ƒä½¿ç”¨ React çš„ [context](https://facebook.github.io/react/docs/context.html)|([ç¿»è¯‘](https://doc.react-china.org/docs/context.html)) åŠŸèƒ½æ¥å®ç°è¿™ä¸€ç‚¹ã€‚

ä½†æ˜¯ï¼Œéœ€è¦è®¿é—® store çš„ç»„ä»¶ä¾ç„¶éœ€è¦ä¸€ç§æ–¹å¼æ¥ä¸å…¶è¿æ¥ã€‚æˆ‘ä»¬ä¹‹å‰æåˆ°äº† `connect()` å‡½æ•°ï¼Œè¯¥å‡½æ•°åˆ©ç”¨å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ç§æŠ€å·§ï¼Œå«åš **currying (æŸ¯é‡ŒåŒ–)** ã€‚åœ¨æŸ¥çœ‹ `connect()` çš„å…·ä½“ä½¿ç”¨æƒ…å†µä¹‹å‰ï¼Œæˆ‘ä»¬ä»”ç»†çœ‹çœ‹ **æŸ¯é‡ŒåŒ–**çš„å·¥ä½œåŸç†ï¼

---

## 3.3 æŸ¯é‡ŒåŒ–

æˆ‘ä»¬å…ˆå°† react å’Œ redux çš„è¿™äº›ä¸œè¥¿æ”¾åœ¨ä¸€è¾¹ï¼Œæ¥èŠèŠæŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰

æŸ¯é‡ŒåŒ–è¿™ä¸ªè¯æ˜¯æ‚¦è€³æ˜“è®°çš„ï¼Œä½†æ„ä¹‰å´å¾ˆæ¨¡ç³Šã€‚æŸ¯é‡ŒåŒ–ä¹Ÿç§°ä¸º**åå‡½æ•°åº”ç”¨**ã€‚é€šå¸¸ï¼Œå…·æœ‰ä¸¤ä¸ªå½¢å‚çš„å‡½æ•°åœ¨è°ƒç”¨æ—¶éœ€è¦ä¼ å…¥ä¸¤ä¸ªå®å‚ï¼š

![1532637961553](assets/1532637961553.png)

ä½†æ˜¯å½“å‡½æ•°æŸ¯é‡ŒåŒ–åï¼Œä½ ä¸éœ€è¦åœ¨è°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥å…¨éƒ¨å‚æ•°ï¼Œï¼ˆæŸ¯é‡ŒåŒ–åçš„ï¼‰å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå‡½æ•°å»æ¥æ”¶å‰©ä½™çš„å‚æ•°ï¼š

![1532638017500](assets/1532638017500.png)

æŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§åŠ¨æ€æŠ€æœ¯ï¼Œå®ƒèƒ½å¤Ÿè®©ä½ åœ¨ä¹‹åçš„æŸä¸ªèŠ‚ç‚¹å‘å‡½æ•°æä¾›ä¸€äº›æ•°æ®ç›´åˆ°å‡½æ•°æ‰€éœ€çš„æ•°æ®è¢«å®Œå…¨æä¾›ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„æŠ€æœ¯ï¼Œæˆ‘ä»¬åœ¨ä¹‹åä¼šçœ‹åˆ° Redux æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚

---

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ plate å‡½æ•°ï¼Œå®ƒå…·æœ‰ä¸¤ä¸ªå‚æ•°ï¼š`vegetable` å’Œ `fruit`ã€‚

```react
function plate(vegetables, fruit) {
  return `I ate a plate of ${vegetables} and ${fruit}!`;
}

plate('corn', 'apples');
```

ç°åœ¨å‡è®¾å› ä¸ºä»»ä½•åŸå› ï¼Œæˆ‘ä»¬æƒ³è¦å°†æ°´æœçš„ä¸Šé¤æ—¶é—´å»¶è¿Ÿåˆ°æŸä¸ªæ—¶é—´ç‚¹ã€‚ä¸€ç§æ–¹å¼æ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—çš„æ˜¯å¯ä»¥ç¨åè°ƒç”¨çš„æ°´æœã€‚

```react
function plate(vegetables) {
  return function fruitFunc (fruit) {
    return `I ate a plate of ${vegetables} and ${fruit}!`;
  }
}

const fruitFunc = plate('corn');
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨ fruitFuncï¼Œå‘å…¶ä¼ å…¥ fruitï¼Œä¾ç„¶å¯ä»¥é€šè¿‡ closure è®¿é—®è”¬èœ (corn)ã€‚

å¦ä¸€ç§æ²¡æœ‰å»¶è¿Ÿçš„ç¼–å†™æ–¹æ³•æ˜¯ï¼š

```react
function plate(vegetables) {
  return function fruitFunc (fruit) {
    return `I ate a plate of ${vegetables} and ${fruit}!`;
  }
}

const sentence = plate('corn')('apples');
```

ä½ å¯èƒ½éœ€è¦èŠ±ç‚¹æ—¶é—´æ‰èƒ½ç†è§£é‡Œé¢çš„åŒé‡è°ƒç”¨ï¼Œæˆ‘ä»¬åˆ†æ­¥è®²è§£ä¸‹ã€‚å½“ä½ è°ƒç”¨ plate å‡½æ•°æ—¶ï¼Œå®ƒè¿”å› fruitFuncï¼Œåè€…è¢«è°ƒç”¨å¹¶ä¼ é€’â€œapplesâ€ã€‚è¿™ä¸€æŠ€å·§åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ä¼šç”¨åˆ°ï¼Œå«åš **currying**ï¼ˆä¹Ÿç§°ä¸ºåå‡½æ•°åº”ç”¨ï¼‰ã€‚

#### ä¹ é¢˜ 1/2

ä¸‹é¢æ˜¯ä¸€ä¸ªå±€éƒ¨åº”ç”¨å‡½æ•°ï¼š

```react
function iceCreamOrder(name) {
    return function flavorPicker (flavor) {
        return function scoops (numScoops) {
            return `${name} ordered ${numScoops} scoops of ${flavor} ice cream!`;
        };
    };
}
```

ä¸‹é¢çš„å“ªä¸ªè°ƒç”¨æ­£ç¡®ï¼Ÿ

- iceCreamOrder('chocolate')(3)
- iceCreamOrder('Richard', 'Cookies & Cream', 2)
- iceCreamOrder('Richard')('Strawberry', 1)
- const func = iceCreamOrder('Richard')('Mint Chocolate Chip') 
  func(5)
  - `iceCreamOrder(''Richard'')(''Mint Chocolate Chip'')`Â è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åè°ƒç”¨å®ƒå¹¶ä¼ å…¥å‚æ•° "5" 



> #### ğŸ’¡ å‡½æ•°è°ƒç”¨ ğŸ’¡
>
> å¦‚æœä½ ä¸ç¡®å®šåº”è¯¥è¿”å›å¤šå°‘ä¸ªå‡½æ•°ï¼Œè¯·çœ‹çœ‹æœ‰å¤šå°‘ä¸ªå‡½æ•°è°ƒç”¨ï¼ä¸€èˆ¬è§„åˆ™æ˜¯è¿”å›çš„å‡½æ•°æ•°é‡æ¯”è°ƒç”¨çš„å‡½æ•°æ•°é‡å°‘ä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œå¦‚æœçœ‹åˆ° 3 ä¸ªå‡½æ•°è°ƒç”¨ï¼Œåˆ™éœ€è¦è¿”å› 2 ä¸ªå‡½æ•°ã€‚



### æŸ¯é‡ŒåŒ–æ€»ç»“

**æŸ¯é‡ŒåŒ–** æ˜¯æŒ‡å‘éœ€è¦é¢å¤–æ•°æ®çš„å‡½æ•°æä¾›éƒ¨åˆ†è¾“å…¥çš„**æµç¨‹**ã€‚Redux API ä½¿ç”¨æŸ¯é‡ŒåŒ–çš„éƒ¨åˆ†æ˜¯å…¶ `connect()` æ–¹æ³•ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ï¼

#### æ·±å…¥ç ”ç©¶

- [åœ¨å‡½æ•°å¼ JavaScript ä¸­è¿›è¡ŒæŸ¯é‡ŒåŒ–çš„åˆå­¦è€…æŒ‡å—](https://www.sitepoint.com/currying-in-functional-javascript/)
- [é€šè¿‡æŸ¯é‡ŒåŒ– JavaScript å®ç°ç¥å¥‡çš„åŠŸèƒ½](http://blog.carbonfive.com/2015/01/14/gettin-freaky-functional-wcurried-javascript/)
- [åœ¨ JavaScript ä¸­è¿›è¡ŒæŸ¯é‡ŒåŒ–](http://kevvv.in/currying-in-javascript/)

---

## 3.4 Connect

Provider ç»„ä»¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„æ–¹å¼å°† store ä¼ é€’ç»™æ‰€æœ‰å­ç»„ä»¶ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬å®é™…ä¸Šä»éœ€è¦ä¸€ç§æ–¹å¼æ¥è®¿é—® store çš„ä¸Šä¸‹æ–‡ã€‚

React-Redux åº“ä¸ºæˆ‘ä»¬æä¾›äº† `connect` æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™é‡Œä¹Ÿæ˜¯ä½ çš„æŠ€èƒ½å’ŒæŸ¯é‡ŒåŒ–æŠ€æœ¯æ´¾ä¸Šç”¨åœºçš„æ—¶å€™ï¼Œå› ä¸º **`connect` ä¼šè¿”å›ä¸€ä¸ªè¢«æŸ¯é‡ŒåŒ–çš„å‡½æ•°**ã€‚

**ä½¿ç”¨ connect æˆ‘ä»¬å¯ä»¥ä¼ å…¥ store çŠ¶æ€çš„ç‰¹å®šéƒ¨åˆ†ï¼Œå¹¶ä¸”å¯ä»¥å°†çŠ¶æ€åˆ†å‘å™¨ï¼ˆaction dispatchï¼‰ä½œä¸ºå±æ€§ä¼ å…¥æˆ‘ä»¬çš„ç»„ä»¶ï¼Œè®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚**



### å®‰è£…

ä½ éœ€è¦ä» NPM ä¸­å®‰è£… react-reduxï¼ˆå¦‚æœå°šæœªå®‰è£…çš„è¯ï¼‰ã€‚

```
npm install --save react-redux
```

å®‰è£…åï¼Œå°±å¯ä»¥ä» react-redux è½¯ä»¶åŒ…ä¸­è·å– `connect()`ï¼š

```react
import { connect } from 'react-redux';
```

### ä½¿ç”¨ Connect

`connect()` æ˜¯ä¸€ç§å‡½æ•°ï¼Œä½¿ç»„ä»¶èƒ½å¤Ÿè·å–æ•°æ®å¹¶ä» Redux store è¿›è¡Œæ´¾é£ã€‚å®ƒçš„è¯­æ³•å¾ˆæœ‰æ„æ€ã€‚å……åˆ†ä½¿ç”¨çš„è¯ï¼Œçœ‹èµ·æ¥å¦‚ä¸‹æ‰€ç¤ºï¼š

```react
connect(mapStateToProps, mapDispatchToProps)(MyComponent)
```

**æé†’ä¸‹ï¼Œ`MyComponent` æ˜¯æ¥æ”¶ store æ•°æ®å’Œ/æˆ–è¿›è¡Œæ´¾é£çš„ç»„ä»¶**ã€‚`mapStateToProps()` æ˜¯æ¥æ”¶å½“å‰ store å’Œå½“å‰å±æ€§ï¼ˆpropsï¼‰çš„å‡½æ•°ï¼Œè¿”å›çš„å†…å®¹å°†ä½œä¸ºå±æ€§ä¼ é€’ç»™ MyComponentã€‚`mapDispatchToProps()` ä½¿ä½ èƒ½å¤Ÿåœ¨æ´¾é£ä¸­å°è£… action creatorã€‚æˆ‘ä»¬æ¥ä»”ç»†çœ‹çœ‹æ¯ä¸ªæ¦‚å¿µï¼

#### mapStateToProps()

`mapStateToProps()` ä½¿ä½ èƒ½å¤ŸæŒ‡å®šä½ å¸Œæœ›å°† store ä¸­çš„å“ªäº›æ•°æ®ä¼ é€’ç»™ React ç»„ä»¶ã€‚ å®ƒéœ€è¦ä¸€ä¸ª store çš„çŠ¶æ€ï¼Œä¸€ä¸ªå¯é€‰çš„ `ownprops` å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚æ£€æŸ¥å…¶å®Œæ•´è¯­æ³•ï¼š

```react
mapStateToProps(state, [ownProps])
```

æ­£å¦‚ Redux æ–‡æ¡£ä¸­æ‰€æè¿°çš„ï¼š

> â€œå¦‚æœæŒ‡å®šäº†è¯¥å‚æ•°ï¼Œæ–°ç»„ä»¶å°†è®¢é˜… Redux store æ›´æ–°ã€‚**è¿™æ„å‘³ç€ä»»ä½•æ—¶å€™ store è¢«æ›´æ–°äº†ï¼ŒmapStateToProps å°†è¢«è°ƒç”¨**ã€‚mapStateToProps çš„ç»“æœå¿…é¡»æ˜¯çº¯å¯¹è±¡ï¼Œå¹¶ä¸ç»„ä»¶çš„å±æ€§åˆå¹¶ã€‚â€

**è¿™æ„å‘³ç€ `mapStateToProps()` è¿”å›çš„å¯¹è±¡ä¸Šçš„å±æ€§å°†å½“åš prop ä¼ é€’ç»™ç»„ä»¶ï¼**

```react
function User ({ name, age }) {}

function mapStateToProps (state, props) {
  return {
    name: state.user.name,
    age: state.user.age,
  }
}

connect(mapStateToProps)(User)
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ`name` å’Œ `age` éƒ½å°†ä½œä¸º prop ä¾›ç»„ä»¶è®¿é—®ã€‚

#### mapDispatchToProps()

å½“ä½ è¿æ¥ç»„ä»¶æ—¶ï¼Œè¯¥ç»„ä»¶å°†è‡ªåŠ¨è¢«ä¼ å…¥ Redux çš„ `dispatch()` æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æƒ³æ´¾é£æŸä¸ª actionï¼Œå¯ä»¥åœ¨ç»„ä»¶ä¸­æŒ‰ä»¥ä¸‹æ–¹å¼æ“ä½œï¼š

```react
import React, { Component } from 'react'
import { connect } from 'react-redux'
import { updateName } from './actions'

class User extends Component {
  state = { name: '' }
  handleUpdateUser = () => {
    this.props.dispatch(updateName(this.state.name))
  }
  render () {}
}

connect()(User)
```

`mapDispatchToProps()` å¯ä»¥ç¨å¾®æ¸…ç†ä¸Šè¿°ä»£ç ã€‚`mapDispatchToProps()` çš„æ•´ä¸ªç›®æ ‡æ˜¯åœ¨ action creator æ¥è§¦ç»„ä»¶ä¹‹å‰ï¼Œè®©ä½ èƒ½å¤Ÿå°† `dispatch()` ç»‘å®šåˆ°è¯¥ action creatorã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 

```react
import React, { Component } from 'react'
import { connect } from 'react-redux'
import { updateName } from './actions'

class User extends Component {
  state = { name: '' }
  handleUpdateUser = () => {
    this.props.boundUpdateName(this.state.name)
  }
  render () {}
}

function mapDispatchToProps (dispatch) {
  return {
    boundUpdateName: (name) => dispatch(updateName(name))
  }
}

connect(null, mapDispatchToProps)(User)
```

**`mapDispatchToProps()` å®Œå…¨æ˜¯å¯é€‰çš„ï¼Œæˆ‘å¹¶ä¸è§‰å¾—å®ƒä¼šä½¿ä¸€åˆ‡æ›´æ•´æ´ï¼Œä½†æ˜¯æœ‰å¿…è¦äº†è§£ä¸‹ã€‚**

---

ç°åœ¨ï¼Œæˆ‘ä»¬å°† App ç»„ä»¶åŒ…è£¹åœ¨äº† Provider ä¸­å¹¶ä¼ å…¥äº† storeï¼Œä»»ä½•éœ€è¦åˆ†æ´¾æˆ–éœ€è¦ä» store è·å–çŠ¶æ€çš„ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨ React Redux çš„ connect å‡½æ•°ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆæ ·çš„ã€‚

åœ¨ä½ çš„ App.js æ–‡ä»¶å†…ï¼Œæˆ‘ä»¬ä» react-redux å¯¼å…¥ connectï¼š

![1532639329571](assets/1532639329571.png)

ç°åœ¨æˆ‘ä»¬è¦åšçš„ä¸åªæ˜¯å¯¼å‡º Appï¼Œæˆ‘ä»¬è¿˜è¦å¯¼å‡º connect å¹¶æ³¨æ„æˆ‘ä»¬å°†è°ƒç”¨å®ƒï¼Œå®ƒå°†å‘æˆ‘ä»¬è¿”å›ä¸€ä¸ªå…¨æ–°çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç»„ä»¶ä½œä¸ºå‚æ•°ä¼ å…¥ï¼š

![1532639438462](assets/1532639438462.png)

ç°åœ¨æˆ‘åœ¨ä¸Šé¢è¿™é‡Œä»¤æ§åˆ¶å°æ‰“å°å‡º this.propsï¼Œä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æœ‰ä¸€ä¸ª dispatchï¼š

![1532639500100](assets/1532639500100.png)

![1532639520436](assets/1532639520436.png)

å¦‚æœä½ éœ€è¦åœ¨ä¸€ä¸ªç»„ä»¶å†…åˆ†æ´¾ actionï¼Œä½ éœ€è¦åšçš„æ˜¯è¿æ¥è¯¥ç»„ä»¶ï¼ˆä½¿ç”¨ connectï¼‰ï¼Œç„¶åä½ å°±èƒ½è°ƒç”¨ dispatch äº†ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ `this.props.dispatch` æ¥è¿›è¡Œæ´¾é£äº†ã€‚

ä½†åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œåœ¨è¿™ä¸ªè§†é¢‘ä¸­ï¼Œæˆ‘ä»¬ä¸åªæ˜¯æƒ³åˆ†æ´¾ actionï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¸æƒ³åœ¨æ­¤è§†é¢‘ä¸­è¿™ä¹ˆåšï¼Œæˆ‘ä»¬æƒ³åšçš„æ˜¯å°† App ç»„ä»¶è¿æ¥åˆ° Redux store ä»¥è·å¾—æˆ‘ä»¬ Redux store ä¸­å­˜åœ¨çš„æ—¥å†çŠ¶æ€ã€‚

è¿™å°±è¦å¼•å…¥ mapStateToProps çš„è¯é¢˜ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯åˆ›å»ºä¸€ä¸ªå«åš mapStateToProps çš„å‡½æ•°ï¼Œ**æ­¤å‡½æ•°è¦åšçš„æ˜¯å°†æˆ‘ä»¬çš„ Redux çŠ¶æ€æ˜ å°„åˆ°ç»„ä»¶ props**ï¼Œé‚£ä¹ˆæ­¤ç»„ä»¶å°†æ¥å—æˆ‘ä»¬çš„çŠ¶æ€ï¼Œå«åšæ—¥å†ã€‚ç°åœ¨ï¼Œåªè¦æˆ‘ä»¬å°† mapStateToProps ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™ connectï¼Œé‚£ä¹ˆæ— è®ºæˆ‘ä»¬åœ¨è¯¥å‡½æ•°ä¸­è¿”å›ä»€ä¹ˆï¼Œéƒ½ä¼šä¼ é€’ç»™æˆ‘ä»¬çš„ç»„ä»¶ã€‚

æˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰ name ä¸º â€œTylerâ€ï¼Œç°åœ¨æˆ‘ä»¬ç”¨ console.log æ–¹æ³•æ‰“å° propsï¼Œä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬ä¸ä»…æœ‰ dispatch è€Œä¸”è¿˜æœ‰ nameï¼š

![1532938751909](assets/1532938751909.png)

æ˜¾ç„¶æˆ‘ä¸æƒ³è¦åå­—ï¼Œæƒ³è¦çš„æ˜¯æ¥è‡ªåº”ç”¨çš„æ—¥å†çŠ¶æ€ï¼Œæˆ‘ä¸åªæ˜¯è¦ä¼ å…¥æ—¥å†çŠ¶æ€ï¼Œæˆ‘æƒ³åšçš„æ˜¯ç¨å¾®é‡æ–°è°ƒæ•´ä¸€ä¸‹å®ƒçš„æ ¼å¼ï¼Œå› ä¸ºä½ è®°å¾—å—ï¼Ÿå®ƒçš„æ ¼å¼ç°åœ¨æ˜¯è¿™æ ·çš„ï¼š

![1532938781792](assets/1532938781792.png)

æˆ‘ä¸æƒ³ä½¿ç”¨è¿™ä¸ªè‡ƒè‚¿çš„å¯¹è±¡ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œè€Œè¯¥å¯¹è±¡å°†åŒ…å«å…·ä½“çš„ä¸€å¤©å’Œç‰¹å®šçš„é¤é¥­ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥è¦åœ¨æ­¤æ–½å±•ä¸€äº› JavaScript é­”æ³•äº†ã€‚

æˆ‘åˆ›å»ºä¸€ä¸ªæ˜ŸæœŸæ•°ç»„ï¼Œå®ƒåŒ…å«ä¸€å‘¨ä¸­çš„æ¯ä¸€å¤©ï¼Œç„¶åæˆ‘è¦åšçš„æ˜¯è¿”å›ä¸€ä¸ªå…·æœ‰ calendar å±æ€§çš„å¯¹è±¡ï¼Œæ­¤ calendar å±æ€§å°†ç­‰äºè°ƒç”¨ dayOrder.map çš„ç»“æœï¼Œæ˜¾ç„¶è¿™å°†æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬è¿˜è¦ä¼ é€’å…·ä½“çš„æ˜ŸæœŸå‡ ï¼Œæˆ‘ä»¬åœ¨æ­¤è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå…·æœ‰æˆ‘æåˆ°çš„ day å±æ€§ã€‚ç°åœ¨ï¼Œæˆ‘æƒ³è·å¾—è¿™ä¸€å¤©çš„æ‰€æœ‰é¤é¥­ï¼Œé‚£ä¹ˆæˆ‘ä»¬è°ƒç”¨ Object.keysï¼Œä¼ å…¥ç‰¹å®šå¤©çš„æ—¥å†ï¼Œå®ƒä¼šå‘æˆ‘ä»¬è¿”å›æ­¤å¯¹è±¡çš„æ‰€æœ‰é”®ï¼Œç„¶åæˆ‘ä»¬è°ƒç”¨ .reduceï¼Œæˆ‘ä»¬å¸Œæœ›å‘ç”Ÿçš„æ˜¯å°†æ‰€æœ‰è¿™äº›å½’çº³ä¸ºå•ä¸ªå¯¹è±¡ã€‚ç„¶åæˆ‘ä»¬è¯´ mealsï¼Œå®ƒæ˜¯è¿™é‡Œè¿™ä¸ªæˆ‘ä»¬åœ¨å½’çº³è¿‡ç¨‹ä¸­æ”¶é›†çš„å¯¹è±¡ï¼Œç„¶åæ¯ä¸€é¡¹å°†ä¸º mealï¼Œæˆ‘ä»¬å®šä¹‰ meals[meal] å°†ç­‰äºå¦‚æœ `calendar[day][meal]` ä¸ºæŸä¸ªä¸œè¥¿ï¼Œå®ƒå°†ç­‰äºæ­¤ `calendar[day][meal]`ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ç­‰äº null ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥è¿”å› mealsï¼š

![1532640417726](assets/1532640417726.png)

> `Object.keys()`Â æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªç”±ä¸€ä¸ªç»™å®šå¯¹è±¡çš„è‡ªèº«å¯æšä¸¾å±æ€§ç»„æˆçš„æ•°ç»„ï¼Œæ•°ç»„ä¸­å±æ€§åçš„æ’åˆ—é¡ºåºå’Œä½¿ç”¨Â [`for...in`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...in)Â å¾ªç¯éå†è¯¥å¯¹è±¡æ—¶è¿”å›çš„é¡ºåºä¸€è‡´ ã€‚ 

> è¿™é‡Œè¿”å›çš„å¯¹è±¡ä¸­ meals çš„å±æ€§å€¼ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼Œåªéœ€è¦ç›´æ¥è¿”å› calendar[day] å°±å¯ä»¥äº†ã€‚ä½†æ˜¯è¿™æ˜¯é”™è¯¯çš„æƒ³æ³•ï¼Œå› ä¸ºè¿™æ ·çš„æ–¹å¼ä¼šè®© meals å±æ€§æŒ‡å‘ calendar[day] çš„å€¼ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ–°å¯¹è±¡ã€‚
>
> ä¸è¿‡ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™æ ·çš„æ–¹å¼ `Object.assign({},calendar[day])}` å’Œ `{...calendar[day]}`

è¿™é‡Œçš„å†…å®¹æŒºå¤šçš„ï¼Œä½†æ˜¯å¦‚æœä¸€åˆ‡æ­£ç¡®è¿è¡Œï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç”¨æ—¥å¿—è®°å½• props æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨æ˜ å°„ days å¹¶åœ¨æ­¤ä½¿ç”¨ reducer åï¼Œçœ‹åˆ°æ–°çš„æ—¥å†æ ¼å¼ã€‚æˆ‘ä»¬è½¬è‡³  propsï¼Œä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬ä»ç„¶æœ‰ dispatchï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬çš„æ—¥å†è®¾ç½®åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªé¡¹æ˜¯ç‰¹å®šçš„ä¸€å¤©ï¼Œç„¶åå®ƒè¿˜æœ‰ä¸€ä¸ª meals å±æ€§ï¼ŒåŒ…å«æ—©é¤ã€åˆé¤ã€æ™šé¤ï¼š

![1532640531784](assets/1532640531784.png)

é‚£ä¹ˆå®ƒçš„ä½œç”¨æ˜¯ï¼Œä½ æ˜¯å¦è®°å¾—åœ¨æœ€ç»ˆé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªç½‘æ ¼ï¼Œå…¶ä¸­æœ‰æ‰€æœ‰æ˜ŸæœŸå‡ å’Œæ‰€æœ‰é¤é¥­ï¼Œç°åœ¨åœ¨æˆ‘ä»¬çš„ç»„ä»¶å†…ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ˜ å°„æ—¥å†å¹¶åˆ›å»ºè¯¥ç½‘æ ¼ã€‚ï¼ˆæŒ‡çš„æ˜¯æœ€ç»ˆé¡¹ç›®çš„æ¸²æŸ“è§†å›¾ï¼‰

è¦å°†åˆå§‹çŠ¶æ€ä»è¿™æ ·è½¬å˜ä¸ºè¿™æ ·ï¼Œç¨å¾®æœ‰ç‚¹çƒ¦äººï¼ˆæŒ‡çš„æ˜¯é»˜è®¤çš„ calendar å¯¹è±¡å¯¹è±¡ï¼Œè½¬å˜ä¸º å¯¹è±¡æ•°ç»„ï¼‰ã€‚ä½† React å’Œ Redux çš„æ€§è´¨å°±æ˜¯å¦‚æ­¤ï¼Œå…·ä½“æ¥è¯´ï¼Œåœ¨ React ä¸­ï¼Œ**å¦‚æœä½ è¦åˆ›å»ºä¸€ä¸ªç½‘æ ¼ï¼Œä½ è¦èƒ½æ˜ å°„ä¸€äº›ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ•°ç»„**ã€‚ä½†æ˜¯**å¯¹äº Reduxï¼Œå°†æ•°æ®ç»“æ„å¤„ç†ä¸ºå¯¹è±¡è¿™æ ·æ›´ä¸ºåˆç†**ã€‚é‚£ä¹ˆ**åœ¨ mapStateToProps ä¸­ï¼Œå®ƒå°†è¿”å›æˆ‘ä»¬æƒ³è¦ä» Redux store è·å–å¹¶ä¼ é€’ç»™ç»„ä»¶çš„çŠ¶æ€ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æŒ‰æƒ³è¦çš„æ–¹å¼é‡æ–°æ ¼å¼åŒ–æ•°æ®çš„ç»“æ„**ã€‚



[è¿™æ˜¯æœ¬è§†é¢‘ä¸­æ‰€åšæ›´æ”¹çš„ commitã€‚](https://github.com/udacity/reactnd-udacimeals-complete/commit/e01aeaf5719ab83cb4af8bf6aa944148335122f9)

---

ä¹‹å‰ï¼Œæˆ‘ä»¬è®²è¿‡å¦‚ä½•ä½¿ç”¨ connect æ–¹æ³•é€šè¿‡ mapStateToProps å°† redux çŠ¶æ€æ˜ å°„åˆ°ç‰¹å®šç»„ä»¶çš„ propsï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ§åˆ¶å°æ‰“å°å‡º App ç»„ä»¶æ¥æ”¶åˆ°çš„ propsï¼Œä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æ¥æ”¶åˆ°äº† dispatch å’Œ calendarï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥å¯¼å…¥ä¸¤ä¸ª action creatorï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½çœ‹åˆ°åœ¨åˆ†æ´¾ action æ—¶åº”ç”¨æ—¶ä»€ä¹ˆæ ·çš„ã€‚

è¿™äº›éƒ½æ¥è‡ªæˆ‘ä»¬çš„ actions æ–‡ä»¶ï¼Œå¦‚æœä½ è¿˜è®°å¾—ï¼Œä»–ä»¬æ˜¯ addRecipe å’Œ removeFromCalendarï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åšçš„æ˜¯å°±åƒä¹‹å‰ä½¿ç”¨ Vanilla Redux æ—¶ä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ†æ´¾ actionï¼Œæˆ‘ä»¬åˆ†æ´¾ addRecipe ç„¶åå‘å®ƒä¼ é€’ä»»æ„ç‰¹å®šå±æ€§ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ¥æ”¶ dispatchï¼Œå¹¶ä¸”æˆ‘ä»¬è¿æ¥äº†ç»„ä»¶ï¼ˆæ„æ€æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨ connect è¿æ¥äº†ç»„ä»¶ï¼Œæ‰€ä»¥ç»„ä»¶å†…å±æ€§ props æœ‰ dispatch å‡½æ•°ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä¼ å…¥ action æ¥æ”¹å˜ store çš„å€¼ã€‚ï¼‰ï¼š

![1532942455376](assets/1532943226885.png)

ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å¦ä¸€ç§æ–¹å¼ï¼Œè¿™ç§æ›´ç®€æ´ä¸€äº›ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå«åš mapDispatchToProps çš„å‡½æ•°ï¼Œä½ å¯èƒ½å·²ç»çŒœåˆ°äº†ï¼Œå®ƒèƒ½è®©æˆ‘ä»¬åšçš„æ˜¯ï¼Œå°† dispatch æ–¹æ³•æ˜ å°„åˆ°ç‰¹å®š propsï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å‘æ­¤æ–¹æ³•ä¼ é€’ dispatchï¼Œè€Œè¿”å›çš„ä¸œè¥¿å°±åƒåœ¨ mapStateToProps ä¸­ä¸€æ ·ï¼Œå°†ä½œä¸º props ä¼ é€’ç»™æˆ‘ä»¬çš„ç»„ä»¶ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸åœ¨è¿™é‡Œåˆ†æ´¾ï¼ˆæŒ‡ä¸Šé¢çš„é‚£é‡Œ doThing() ï¼‰ï¼Œè€Œæ˜¯å‘æ­¤å¯¹è±¡æ·»åŠ ä¸€äº›å±æ€§ï¼Œå‡å¦‚è¯´ selectRecipe æ˜¯ç¬¬ä¸€ä¸ªï¼Œæ­¤å‡½æ•°å°†æ¥å—æ•°æ®ï¼Œç„¶åè°ƒç”¨ dispatch åœ¨å…¶ä¸­è°ƒç”¨ addRecipe å¹¶ä¼ å…¥æ•°æ®ï¼Œç„¶åæ­¤å¯¹è±¡ä¸Šçš„ç¬¬äºŒä¸ªæ–¹æ³•å°†æ˜¯ removeï¼Œå®ƒåŒæ ·ä¹Ÿå°†æ¥å—æ•°æ®ï¼Œç„¶åå®ƒå°†åˆ†æ´¾ removeFromCalendar å¹¶ä¼ å…¥æ•°æ®ã€‚ï¼ˆè¿™æ ·åšï¼Œå®é™…ä¸Šæ˜¯é›†ä¸­å¼çš„å°† dispatch æ”¾å…¥ä¸€ä¸ªåœ°æ–¹ï¼Œä½†å…¶å®å’Œåœ¨ç»„ä»¶å†…ä½¿ç”¨ç»„ä»¶æ–¹æ³•çš„å½¢å¼è°ƒç”¨ dispatch ç›¸åŒï¼Œåªæ˜¯ä¹‹å‰çš„è°ƒç”¨æ˜¯é€šè¿‡ this.handlerï¼Œç°åœ¨æ˜¯é€šè¿‡ this.props.handlerï¼‰

![1532943098526](assets/1532943098526.png)

ç°åœ¨ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨ä¼ é€’ç»™ç»„ä»¶çš„ dispatch å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åšçš„æ˜¯é€šè¿‡å°†å®ƒä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ connectï¼Œå°† mapDispatchToProps ç»‘å®šåˆ°æˆ‘ä»¬çš„ç»„ä»¶ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬çš„ç»„ä»¶ props ä¸Šå°†æœ‰ä¸€ä¸ª selectRecipe æ–¹æ³•å’Œä¸€ä¸ª remove æ–¹æ³•ï¼Œç„¶åå½“è¿™äº›å‡½æ•°è°ƒç”¨æ—¶ï¼Œå®ƒä»¬å°†è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ†æ´¾ã€‚å†æ¬¡è¯´æ˜ï¼Œè¿™æ˜¯å¦ä¸€ç§å¯é€‰çš„æ–¹æ³•ï¼Œä½ å¦‚æœä¸æƒ³ç”¨ä¹Ÿå¯ä»¥ä¸ç”¨ï¼Œç›´æ¥è°ƒç”¨ this.props.dispatchï¼Œç„¶ååœ¨å…¶ä¸­ä¼ å…¥ action creator ä¹Ÿå®Œå…¨å¯ä»¥ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ mapDispatchToProps **è®©ä½ çš„ç»„ä»¶æ›´ç®€æ´ä¸€ç‚¹**ã€‚

åœ¨è¿™é‡Œæˆ‘ä»¬ä¸è°ƒç”¨ this.props.dispatchï¼Œè€Œåªæ˜¯è°ƒç”¨ this.props.selectRecipeï¼Œç„¶åä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼š

![1532943495518](assets/1532943495518.png)

åŒæ ·ï¼Œæˆ‘ä»¬çœ‹çœ‹æ­¤ç»„ä»¶åœ¨æ¥æ”¶ä»€ä¹ˆï¼Œæ³¨æ„ç”±äºæˆ‘ä»¬åœ¨ä½¿ç”¨ mapDispatchToProps ï¼Œæˆ‘ä»¬ä¸å†åœ¨ç»„ä»¶ä¸­æ¥æ”¶ dispatch ä½œä¸º propsï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œæ¥æ”¶ selectRecipe å’Œ removeï¼š

![1532943561273](assets/1532943561273.png)

ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œç”±äºä½¿ç”¨äº† mapDispatchToProps ï¼Œprops ä¸­æ²¡æœ‰äº† dispatch æ–¹æ³•ï¼‰

selectRecipe å’Œ remove å°†åœ¨è¢«è°ƒç”¨æ—¶è‡ªåŠ¨åˆ†æ´¾ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå°† action creator åŒ…è£¹åœ¨ mapDispatchToProps ä¸­çš„ dispatch å†…ï¼Œä»¥ä½¿æˆ‘ä»¬çš„ç»„ä»¶æ›´ç®€æ´ä¸€äº›ã€‚å› ä¸ºæˆ‘ä»¬ç°åœ¨å¯ä»¥ç›´æ¥è°ƒç”¨ this.props. å°†ä¸Š mapDispatchToProps  ä¸­çš„æ–¹æ³•å°±å¯ä»¥äº†ã€‚



[è¿™æ˜¯æœ¬è§†é¢‘ä¸­æ‰€åšæ›´æ”¹çš„ commitã€‚](https://github.com/udacity/reactnd-udacimeals-complete/commit/66a4a3ecae2d9dd4f3b20611529c4c55be19a3b2)

---

#### ä¹ é¢˜ 1/3

`connect()` ä¼šè¿æ¥å“ªä¸¤é¡¹?

- Action
- Action creator
- Store :star:
  - é€šè¿‡Â `connect()`ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°è®¿é—®Â `Provider`Â è®¾ç½®çš„Â `store`Â `context`ã€‚æˆ‘ä»¬å°†ä¸€éƒ¨åˆ†çŠ¶æ€å’Œ action-dispatch å½“åšå±æ€§ä¼ é€’ç»™ç»„ä»¶ã€‚ 
- Reducer
- API util
- Component :star:

æäº¤

#### ä¹ é¢˜ 2/3

å‡è®¾æœ‰ä¸€ä¸ªç®€å•çš„ React ç»„ä»¶ `MyComponent`ã€‚`MyComponent` å¦‚ä½•è®¿é—®çŠ¶æ€ï¼Ÿ

- æ•´ä¸ª store è¢«ä¼ å…¥ `connect()`ï¼Œåè€…ä¸ MyComponent ä¸€èµ·æŸ¯é‡ŒåŒ–
- å”¯ä¸€æ–¹å¼æ˜¯å°† store ä»çˆ¶ç»„ä»¶é‚£å‘ä¸‹ä¼ é€’ç»™å­ç»„ä»¶ï¼Œç›´åˆ°æŠµè¾¾ MyComponent
- å®¹å™¨ç»„ä»¶å°† store è¿æ¥åˆ° MyComponentï¼Œå‘ MyComponent æä¾›å¯é€šè¿‡ prop è®¿é—®çš„éƒ¨åˆ†çŠ¶æ€ :star:
  - `mapStateToProps`Â æ˜¯ä¸€ç§å‡½æ•°ï¼Œè®©Â `connect()`Â çŸ¥é“å¦‚ä½•å°†`çŠ¶æ€`æ˜ å°„åˆ°ç»„ä»¶çš„å±æ€§åˆ—è¡¨ä¸­ã€‚ 
- MyComponent å¯é€šè¿‡ `this.state` è®¿é—®çŠ¶æ€ï¼Œå› ä¸ºæ‰€æœ‰çŠ¶æ€éƒ½åº”å§‹ç»ˆå­˜å‚¨åœ¨ Redux åº”ç”¨ä¸­çš„ç»„ä»¶æœ¬èº«é‡Œã€‚

æäº¤

#### ä¹ é¢˜ 3/3

ContactForm ä¼šå°†å“ªäº›å˜é‡ä½œä¸º prop æ¥æ”¶ï¼Ÿ

```react
const ContactForm = ({ firstName, handleAdd }) => (<div>...</div>);

const mapStateToProps = state => ({
        fullName: state.name
});

const mapDispatchToProps = dispatch => ({
        handleAdd: contact => dispatch(addContact(contact))
});

export default connect(
        mapStateToProps,
        mapDispatchToProps
)(ContactForm);
```

- fullName :star:
  - `fullName`Â å°†ä½¿Â `ContactForm`Â ç»„ä»¶èƒ½å¤Ÿè®¿é—®éƒ¨åˆ†çŠ¶æ€ï¼Œè€ŒÂ `handleAdd`Â åˆ™ä½¿å…¶èƒ½å¤Ÿè®¿é—® action-dispatchã€‚ 
- mapDispatchToProps
- mapStateToProps
- contact
- handleAdd :star:
- the entire state



### Connect æ€»ç»“

`connect()` å°† React ç»„ä»¶è¿æ¥åˆ° Redux storeã€‚`mapStateToProps()` ä½¿æˆ‘ä»¬èƒ½å¤ŸæŒ‡å®šè¦å°† store ä¸­çš„å“ªä¸ªçŠ¶æ€ä¼ é€’ç»™ React ç»„ä»¶ã€‚`mapDispatchToProps()` ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ action creator æŠµè¾¾ç»„ä»¶ä¹‹å‰ï¼Œå°† dispatch ç»‘å®šåˆ°è¯¥ action creatorã€‚

### æ›´å¤šèµ„æ–™

- [react-redux æ–‡æ¡£ä¸­çš„ connect()](https://github.com/reactjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options)
- [connect() ä¸ subscribe()](https://stackoverflow.com/a/41963751) æ¥è‡ª StackOverflow

---

## 3.5 è¯¾ç¨‹æ€»ç»“

æˆ‘ä»¬åœ¨è¿™èŠ‚è¯¾ä¸­æ¶µç›–äº†å¾ˆå¤šé‡è¦çš„è¯é¢˜ï¼Œæˆ‘ä»¬å°†æ–°å­¦åˆ°çš„ Redux çŸ¥è¯†è¿ç”¨åˆ°äº†æˆ‘ä»¬çš„ React åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä½¿ç”¨ React-Redux åº“å¸®åŠ©æˆ‘ä»¬é¡ºåˆ©åœ°å°† Redux å’Œ React è¿æ¥èµ·æ¥ï¼Œæˆ‘ä»¬è¿˜å­¦ä¹ äº†æŸ¯é‡ŒåŒ–ï¼ˆcurryingï¼‰å¹¶ä¸”åœ¨ connect æ–¹æ³•ä¸­ä½¿ç”¨å®ƒã€‚

åœ¨ä¸‹èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•æ„å»º Redux storeã€‚